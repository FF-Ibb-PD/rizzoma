#!/bin/bash

cd $(dirname $0)/../node_modules/

# symlink compiled_modules/xx/node_modules into compiled_modules/current
if [ "$(uname -m)" == "x86_64" ] ; then
    TYPE="64"
else
    TYPE="32"
fi
echo "System is $TYPE-bit"

(
    cd compiled_modules
    test -h current && unlink current
    ln -s "$TYPE/node_modules" "current"
)

# symlink compiled_modules/current/xx into ./xx
for path in compiled_modules/current/* ; do
    file=$(basename $path)
    echo "Symlinking $file"
    test -h $file && unlink $file
    test -d $file && echo "Directory $file exists, skipping" || ln -s $path .
done
