gadgets=window["gadgets"]||{};shindig=window["shindig"]||{};osapi=window["osapi"]||{};
if(!window["gadgets"]["config"]){gadgets.config=function(){var ___jsl;var components={};var configuration={};var initialized=false;function foldConfig(origConfig,updConfig){for(var key in updConfig){if(!updConfig.hasOwnProperty(key)){continue;}if(typeof origConfig[key]==="object"&&typeof updConfig[key]==="object"){foldConfig(origConfig[key],updConfig[key]);}else{origConfig[key]=updConfig[key];}}}function getLoadingScript(){var jsPath=(configuration["core.io"]||{})["jsPath"]||null,candidates=[],n=0;var scripts=document.scripts||document.getElementsByTagName("script");if(!scripts||scripts.length==0){return candidates;}for(var i=0;i<scripts.length;++i){var src=scripts[i].src,found=jsPath!=null&&src&&src.indexOf(jsPath)||-1;if(found!=-1&&/.*[.]js.*[?&]c=[01](#|&|$).*/.test(src.substring(found+jsPath.length))){candidates[n++]=scripts[i];}}if(!candidates.length){var tag=scripts[scripts.length-1];if(tag.src){candidates[0]=tag;}}return candidates;}function getInnerText(scriptNode){var scriptText="";if(scriptNode.nodeType==3||scriptNode.nodeType==4){scriptText=scriptNode.nodeValue;}else{if(scriptNode.innerText){scriptText=scriptNode.innerText;}else{if(scriptNode.innerHTML){scriptText=scriptNode.innerHTML;}else{if(scriptNode.firstChild){var content=[];for(var child=scriptNode.firstChild;child;child=child.nextSibling){content.push(getInnerText(child));}scriptText=content.join("");}}}}return scriptText;}function parseConfig(configText){var config;try{config=(new Function("return ("+configText+"\n)"))();}catch(e){}if(typeof config==="object"){return config;}try{config=(new Function("return ({"+configText+"\n})"))();}catch(e){}return typeof config==="object"?config:{};}function augmentConfig(baseConfig){var scripts=getLoadingScript();if(!scripts.length){return;}for(var i=0;i<scripts.length;i++){var scriptText=getInnerText(scripts[i]);var configAugment=parseConfig(scriptText);if(___jsl["f"]&&___jsl["f"].length==1){var feature=___jsl["f"][0];if(!configAugment[feature]){var newConfig={};newConfig[___jsl["f"][0]]=configAugment;configAugment=newConfig;}}foldConfig(baseConfig,configAugment);var globalConfig=window["___cfg"];if(globalConfig){foldConfig(baseConfig,globalConfig);}}}function forAllComponents(processor){for(var name in components){if(components.hasOwnProperty(name)){var componentList=components[name];for(var i=0,j=componentList.length;i<j;++i){processor(name,componentList[i]);}}}}return{register:function(component,opt_validators,opt_callback,opt_callOnUpdate){var registered=components[component];if(!registered){registered=[];components[component]=registered;}registered.push({validators:opt_validators||{},callback:opt_callback,callOnUpdate:opt_callOnUpdate});if(initialized&&opt_callback){opt_callback(configuration);}},get:function(opt_component){if(opt_component){return configuration[opt_component]||{};}return configuration;},init:function(config,opt_noValidation){___jsl=window["___jsl"]||{};foldConfig(configuration,config);augmentConfig(configuration);var inlineOverride=window["___config"]||{};foldConfig(configuration,inlineOverride);forAllComponents(function(name,component){var conf=configuration[name];if(conf&&!opt_noValidation){var validators=component.validators;for(var v in validators){if(validators.hasOwnProperty(v)){if(!validators[v](conf[v])){throw new Error('Invalid config value "'+conf[v]+'" for parameter "'+v+'" in component "'+name+'"');}}}}if(component.callback){component.callback(configuration);}});initialized=true;},update:function(updateConfig,opt_replace){var callbacks=[];forAllComponents(function(name,component){if(updateConfig.hasOwnProperty(name)||(opt_replace&&configuration&&configuration[name])){if(component.callback&&component.callOnUpdate){callbacks.push(component.callback);}}});configuration=opt_replace?{}:configuration||{};foldConfig(configuration,updateConfig);for(var i=0,j=callbacks.length;i<j;++i){callbacks[i](configuration);}},clear:function(){gadgets.warn("This method is for testing.");var undef;___jsl=undef;configuration={};initialized=false;}};}();}
(function(){gadgets.config.EnumValidator=function(list){var listItems=[];if(arguments.length>1){for(var i=0,arg;(arg=arguments[i]);++i){listItems.push(arg);}}else{listItems=list;}return function(data){for(var i=0,test;(test=listItems[i]);++i){if(data===listItems[i]){return true;}}return false;};};gadgets.config.RegExValidator=function(re){return function(data){return re.test(data);};};gadgets.config.ExistsValidator=function(data){return typeof data!=="undefined";};gadgets.config.NonEmptyStringValidator=function(data){return typeof data==="string"&&data.length>0;};gadgets.config.BooleanValidator=function(data){return typeof data==="boolean";};gadgets.config.LikeValidator=function(test){return function(data){for(var member in test){if(test.hasOwnProperty(member)){var t=test[member];if(!t(data[member])){return false;}}}return true;};};})();
var safeJSON=window["safeJSON"];var tamings___=window["tamings___"]||[];var bridge___;var caja___=window["caja___"];var ___=window["___"];
gadgets.util=gadgets.util||{};gadgets.util.makeClosure=function(scope,callback,var_args){var baseArgs=[];for(var i=2,j=arguments.length;i<j;++i){baseArgs.push(arguments[i]);}return function(){var tmpArgs=baseArgs.slice();for(var i=0,j=arguments.length;i<j;++i){tmpArgs.push(arguments[i]);}return callback.apply(scope,tmpArgs);};};gadgets.util.makeEnum=function(values){var i,v,obj={};for(i=0;(v=values[i]);++i){obj[v]=v;}return obj;};gadgets.util.shouldPollXhrReadyStateChange=function(){if(document.all&&!document.querySelector){return true;}return false;};
tamings___.push(function(imports){caja___.whitelistFuncs([[gadgets.util,"makeClosure"],[gadgets.util,"makeEnum"],[gadgets.util,"shouldPollXhrReadyStateChange"]]);});
gadgets.util=gadgets.util||{};(function(){var XHTML_SPEC="http://www.w3.org/1999/xhtml";function attachAttributes(elem,opt_attribs){var attribs=opt_attribs||{};for(var attrib in attribs){if(attribs.hasOwnProperty(attrib)){elem[attrib]=attribs[attrib];}}}function stringifyElement(tagName,opt_attribs){var arr=["<",tagName];var attribs=opt_attribs||{};for(var attrib in attribs){if(attribs.hasOwnProperty(attrib)){arr.push(" ");arr.push(attrib);arr.push('="');arr.push(gadgets.util.escapeString(attribs[attrib]));arr.push('"');}}arr.push("></");arr.push(tagName);arr.push(">");return arr.join("");}gadgets.util.createElement=function(tagName){var element;if((!document.body)||document.body.namespaceURI){try{element=document.createElementNS(XHTML_SPEC,tagName);}catch(nonXmlDomException){}}return element||document.createElement(tagName);};gadgets.util.createIframeElement=function(opt_attribs){var frame=gadgets.util.createElement("iframe");try{var tagString=stringifyElement("iframe",opt_attribs);var ieFrame=gadgets.util.createElement(tagString);if(ieFrame&&((!frame)||((ieFrame.tagName==frame.tagName)&&(ieFrame.namespaceURI==frame.namespaceURI)))){frame=ieFrame;}}catch(nonStandardCallFailed){}attachAttributes(frame,opt_attribs);return frame;};gadgets.util.getBodyElement=function(){if(document.body){return document.body;}try{var xbodies=document.getElementsByTagNameNS(XHTML_SPEC,"body");if(xbodies&&(xbodies.length==1)){return xbodies[0];}}catch(nonXmlDomException){}return document.documentElement||document;};})();
gadgets.log=(function(){var info_=1;var warning_=2;var error_=3;var none_=4;var log=function(message){logAtLevel(info_,message);};gadgets.warn=function(message){logAtLevel(warning_,message);};gadgets.error=function(message){logAtLevel(error_,message);};gadgets.setLogLevel=function(logLevel){logLevelThreshold_=logLevel;};function logAtLevel(level,message){if(typeof _console==="undefined"){_console=window.console?window.console:window.opera?window.opera.postError:null;}if(level<logLevelThreshold_||!_console){return;}if(level===warning_&&_console.warn){_console.warn(message);}else{if(level===error_&&_console.error){_console.error(message);}else{if(_console.log){_console.log(message);}}}}log["INFO"]=info_;log["WARNING"]=warning_;log["NONE"]=none_;var logLevelThreshold_=info_;var _console;return log;})();
tamings___.push(function(imports){caja___.whitelistFuncs([[gadgets,"log"],[gadgets,"warn"],[gadgets,"error"],[gadgets,"setLogLevel"]]);caja___.whitelistProps([[gadgets.log,"INFO"],[gadgets.log,"WARNING"],[gadgets.log,"ERROR"],[gadgets.log,"NONE"]]);});
gadgets.util=gadgets.util||{};gadgets.util.attachBrowserEvent=function(elem,eventName,callback,useCapture){if(typeof elem.addEventListener!="undefined"){elem.addEventListener(eventName,callback,useCapture);}else{if(typeof elem.attachEvent!="undefined"){elem.attachEvent("on"+eventName,callback);}else{gadgets.warn("cannot attachBrowserEvent: "+eventName);}}};gadgets.util.removeBrowserEvent=function(elem,eventName,callback,useCapture){if(elem.removeEventListener){elem.removeEventListener(eventName,callback,useCapture);}else{if(elem.detachEvent){elem.detachEvent("on"+eventName,callback);}else{gadgets.warn("cannot removeBrowserEvent: "+eventName);}}};
gadgets.util=gadgets.util||{};(function(){var onLoadHandlers=[];gadgets.util.registerOnLoadHandler=function(callback){onLoadHandlers.push(callback);};gadgets.util.runOnLoadHandlers=function(){gadgets.util.registerOnLoadHandler=function(cb){cb();};for(var i=0,j=onLoadHandlers.length;i<j;++i){try{onLoadHandlers[i]();}catch(ex){gadgets.warn("Could not fire onloadhandler "+ex.message);}}onLoadHandlers=undefined;};})();
tamings___.push(function(imports){caja___.whitelistFuncs([[gadgets.util,"registerOnLoadHandler"]]);});
gadgets.util=gadgets.util||{};(function(){var escapeCodePoints={0:false,10:true,13:true,34:true,39:true,60:true,62:true,92:true,8232:true,8233:true,65282:true,65287:true,65308:true,65310:true,65340:true};function unescapeEntity(match,value){return String.fromCharCode(value);}gadgets.util.escape=function(input,opt_escapeObjects){if(!input){return input;}else{if(typeof input==="string"){return gadgets.util.escapeString(input);}else{if(typeof input==="array"){for(var i=0,j=input.length;i<j;++i){input[i]=gadgets.util.escape(input[i]);}}else{if(typeof input==="object"&&opt_escapeObjects){var newObject={};for(var field in input){if(input.hasOwnProperty(field)){newObject[gadgets.util.escapeString(field)]=gadgets.util.escape(input[field],true);}}return newObject;}}}}return input;};gadgets.util.escapeString=function(str){if(!str){return str;}var out=[],ch,shouldEscape;for(var i=0,j=str.length;i<j;++i){ch=str.charCodeAt(i);shouldEscape=escapeCodePoints[ch];if(shouldEscape===true){out.push("&#",ch,";");}else{if(shouldEscape!==false){out.push(str.charAt(i));}}}return out.join("");};gadgets.util.unescapeString=function(str){if(!str){return str;}return str.replace(/&#([0-9]+);/g,unescapeEntity);};})();
tamings___.push(function(imports){caja___.whitelistFuncs([[gadgets.util,"escape"],[gadgets.util,"escapeString"],[gadgets.util,"unescapeString"]]);});
gadgets.util=gadgets.util||{};(function(){var parameters=null;function parseUrlParams(url){var query;var queryIdx=url.indexOf("?");var hashIdx=url.indexOf("#");if(hashIdx===-1){query=url.substr(queryIdx+1);}else{query=[url.substr(queryIdx+1,hashIdx-queryIdx-1),"&",url.substr(hashIdx+1)].join("");}return query.split("&");}gadgets.util.getUrlParameters=function(opt_url){var no_opt_url=typeof opt_url==="undefined";if(parameters!==null&&no_opt_url){return parameters;}var parsed={};var pairs=parseUrlParams(opt_url||document.location.href);var unesc=window.decodeURIComponent?decodeURIComponent:unescape;for(var i=0,j=pairs.length;i<j;++i){var pos=pairs[i].indexOf("=");if(pos===-1){continue;}var argName=pairs[i].substring(0,pos);var value=pairs[i].substring(pos+1);value=value.replace(/\+/g," ");try{parsed[argName]=unesc(value);}catch(e){}}if(no_opt_url){parameters=parsed;}return parsed;};})();gadgets.util.getUrlParameters();
tamings___.push(function(imports){caja___.whitelistFuncs([[gadgets.util,"getUrlParameters"]]);});
gadgets.util=gadgets.util||{};(function(){var features={};var services={};function init(config){features=config["core.util"]||{};}if(gadgets.config){gadgets.config.register("core.util",null,init);}gadgets.util.getFeatureParameters=function(feature){return typeof features[feature]==="undefined"?null:features[feature];};gadgets.util.hasFeature=function(feature){return typeof features[feature]!=="undefined";};gadgets.util.getServices=function(){return services;};})();
tamings___.push(function(imports){caja___.whitelistFuncs([[gadgets.util,"getFeatureParameters"],[gadgets.util,"hasFeature"]]);});
shindig.Auth=function(){var authToken=null;var trusted=null;function addParamsToToken(urlParams){var args=authToken.split("&");for(var i=0;i<args.length;i++){var nameAndValue=args[i].split("=");if(nameAndValue.length===2){var name=nameAndValue[0];var value=nameAndValue[1];if(value==="$"){value=encodeURIComponent(urlParams[name]);args[i]=name+"="+value;}}}authToken=args.join("&");}function init(configuration){var urlParams=gadgets.util.getUrlParameters();var config=configuration["shindig.auth"]||{};if(config["authToken"]){authToken=config["authToken"];}else{if(urlParams["st"]){authToken=urlParams["st"];}}if(authToken!==null){addParamsToToken(urlParams);}if(config["trustedJson"]){trusted=eval("("+config["trustedJson"]+")");}}gadgets.config.register("shindig.auth",null,init);return{getSecurityToken:function(){return authToken;},updateSecurityToken:function(newToken){authToken=newToken;},getTrustedData:function(){return trusted;}};};
shindig.auth=new shindig.Auth();
if(window.JSON&&window.JSON.parse&&window.JSON.stringify){gadgets.json=(function(){var endsWith___=/___$/;function getOrigValue(key,value){var origValue=this[key];return origValue;}return{parse:function(str){try{return window.JSON.parse(str);}catch(e){return false;}},stringify:function(obj){var orig=window.JSON.stringify;function patchedStringify(val){return orig.call(this,val,getOrigValue);}var stringifyFn=(Array.prototype.toJSON&&orig([{x:1}])==='"[{\\"x\\": 1}]"')?patchedStringify:orig;try{return stringifyFn(obj,function(k,v){return !endsWith___.test(k)?v:void 0;});}catch(e){return null;}}};})();}
if(!(window.JSON&&window.JSON.parse&&window.JSON.stringify)){gadgets.json=function(){function f(n){return n<10?"0"+n:n;}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",f(this.getUTCMonth()+1),"-",f(this.getUTCDate()),"T",f(this.getUTCHours()),":",f(this.getUTCMinutes()),":",f(this.getUTCSeconds()),"Z"].join("");};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function stringify(value){var a,i,k,l,r=/[\"\\\x00-\x1f\x7f-\x9f]/g,v;switch(typeof value){case"string":return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];if(c){return c;}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);})+'"':'"'+value+'"';case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null";}a=[];if(typeof value.length==="number"&&!value.propertyIsEnumerable("length")){l=value.length;for(i=0;i<l;i+=1){a.push(stringify(value[i])||"null");}return"["+a.join(",")+"]";}for(k in value){if(/___$/.test(k)){continue;}if(value.hasOwnProperty(k)){if(typeof k==="string"){v=stringify(value[k]);if(v){a.push(stringify(k)+":"+v);}}}}return"{"+a.join(",")+"}";}return"";}return{stringify:stringify,parse:function(text){if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return eval("("+text+")");}return false;}};}();}
gadgets.json.flatten=function(obj){var flat={};if(obj===null||typeof obj=="undefined"){return flat;}for(var k in obj){if(obj.hasOwnProperty(k)){var value=obj[k];if(null===value||typeof value=="undefined"){continue;}flat[k]=(typeof value==="string")?value:gadgets.json.stringify(value);}}return flat;};
gadgets.io=function(){var ioTransactionId=0;var ajaxPollQ={};var config={};var oauthState;function makeXhr(){var x;if(typeof shindig!="undefined"&&shindig.xhrwrapper&&shindig.xhrwrapper.createXHR){return shindig.xhrwrapper.createXHR();}else{if(typeof ActiveXObject!="undefined"){try{x=new ActiveXObject("Msxml2.XMLHTTP");if(!x){x=new ActiveXObject("Microsoft.XMLHTTP");}return x;}catch(e){}}}if(typeof XMLHttpRequest!="undefined"||window.XMLHttpRequest){return new window.XMLHttpRequest();}else{throw ("no xhr available");}}function hadError(xobj,callback){if(xobj["readyState"]!==4){return true;}try{if(xobj["status"]!==200){var error=(""+xobj["status"]);if(xobj["responseText"]){error=error+" "+xobj["responseText"];}callback({"errors":[error],"rc":xobj["status"],"text":xobj["responseText"]});return true;}}catch(e){callback({"errors":[e["number"]+" Error not specified"],"rc":e["number"],"text":e["description"]});return true;}return false;}function processNonProxiedResponse(url,callback,params,xobj){if(hadError(xobj,callback)){return;}var data={"body":xobj["responseText"]};callback(transformResponseData(params,data));}function processResponse(url,callback,params,xobj){if(hadError(xobj,callback)){return;}var txt=xobj["responseText"];var UNPARSEABLE_CRUFT=config["unparseableCruft"];var offset=txt.indexOf(UNPARSEABLE_CRUFT)+UNPARSEABLE_CRUFT.length;if(offset<UNPARSEABLE_CRUFT.length){return;}txt=txt.substr(offset);var data=eval("("+txt+")");data=data[url];if(data["oauthState"]){oauthState=data["oauthState"];}if(data["st"]){shindig.auth.updateSecurityToken(data["st"]);}callback(transformResponseData(params,data));}function transformResponseData(params,data){var resp={"text":data["body"],"rc":data["rc"]||200,"headers":data["headers"],"oauthApprovalUrl":data["oauthApprovalUrl"],"oauthError":data["oauthError"],"oauthErrorText":data["oauthErrorText"],"oauthErrorTrace":data["oauthErrorTrace"],"oauthErrorUri":data["oauthErrorUri"],"oauthErrorExplanation":data["oauthErrorExplanation"],"errors":[]};if(resp["rc"]<200||resp["rc"]>=400){resp["errors"]=[resp["rc"]+" Error"];}else{if(resp["text"]){if(resp["rc"]>=300&&resp["rc"]<400){params["CONTENT_TYPE"]="TEXT";}switch(params["CONTENT_TYPE"]){case"JSON":case"FEED":resp["data"]=gadgets.json.parse(resp.text);if(!resp["data"]){resp["errors"].push("500 Failed to parse JSON");resp["rc"]=500;resp["data"]=null;}break;case"DOM":var dom;if(typeof DOMParser!="undefined"){var parser=new DOMParser();dom=parser.parseFromString(resp["text"],"text/xml");if("parsererror"===dom.documentElement.nodeName){resp["errors"].push("500 Failed to parse XML");resp["rc"]=500;}else{resp["data"]=dom;}}else{if(typeof ActiveXObject!="undefined"){dom=new ActiveXObject("Microsoft.XMLDOM");dom.async=false;dom.validateOnParse=false;dom.resolveExternals=false;if(!dom.loadXML(resp["text"])){resp["errors"].push("500 Failed to parse XML");resp["rc"]=500;}else{resp["data"]=dom;}}else{resp["errors"].push("500 Failed to parse XML because no DOM parser was available");resp["rc"]=500;}}break;default:resp["data"]=resp["text"];break;}}}return resp;}function makeXhrRequest(realUrl,proxyUrl,callback,paramData,method,params,processResponseFunction,opt_headers){var xhr=makeXhr();if(proxyUrl.indexOf("//")==0){proxyUrl=document.location.protocol+proxyUrl;}xhr.open(method,proxyUrl,true);if(callback){var closureCallback=gadgets.util.makeClosure(null,processResponseFunction,realUrl,callback,params,xhr);var shouldPoll=gadgets.util.shouldPollXhrReadyStateChange();if(shouldPoll){handleReadyState(xhr,closureCallback);}else{xhr.onreadystatechange=closureCallback;}}if(typeof opt_headers==="string"){contentType=opt_headers;opt_headers={};}var headers=opt_headers||{};if(paramData!==null){var contentTypeHeader="Content-Type";var contentType="application/x-www-form-urlencoded";if(!headers[contentTypeHeader]){headers[contentTypeHeader]=contentType;}}for(var headerName in headers){xhr.setRequestHeader(headerName,headers[headerName]);}xhr.send(paramData);}function handleReadyState(xhr,callback){var tempTid=ioTransactionId;var pollInterval=config["xhrPollIntervalMs"]||50;ajaxPollQ[tempTid]=window.setInterval(function(){if(xhr&&xhr.readyState===4){window.clearInterval(ajaxPollQ[tempTid]);delete ajaxPollQ[tempTid];if(callback){callback();}}},pollInterval);ioTransactionId++;}function respondWithPreload(postData,params,callback){if(gadgets.io.preloaded_&&postData.httpMethod==="GET"){for(var i=0;i<gadgets.io.preloaded_.length;i++){var preload=gadgets.io.preloaded_[i];if(preload&&(preload.id===postData.url)){delete gadgets.io.preloaded_[i];if(preload["rc"]!==200){callback({"rc":preload["rc"],"errors":[preload["rc"]+" Error"]});}else{if(preload["oauthState"]){oauthState=preload["oauthState"];}var resp={"body":preload["body"],"rc":preload["rc"],"headers":preload["headers"],"oauthApprovalUrl":preload["oauthApprovalUrl"],"oauthError":preload["oauthError"],"oauthErrorText":preload["oauthErrorText"],"oauthErrorTrace":preload["oauthErrorTrace"],"oauthErrorUri":preload["oauthErrorUri"],"oauthErrorExplanation":preload["oauthErrorExplanation"],"errors":[]};callback(transformResponseData(params,resp));}return true;}}}return false;}function init(configuration){config=configuration["core.io"]||{};}gadgets.config.register("core.io",null,init);return{makeRequest:function(url,callback,opt_params){var params=opt_params||{};var httpMethod=params["METHOD"]||"GET";var refreshInterval=params["REFRESH_INTERVAL"];var auth,st;if(params["AUTHORIZATION"]&&params["AUTHORIZATION"]!=="NONE"){auth=params["AUTHORIZATION"].toLowerCase();st=shindig.auth.getSecurityToken();}var signOwner=true;if(typeof params["SIGN_OWNER"]!=="undefined"){signOwner=params["SIGN_OWNER"];}var signViewer=true;if(typeof params["SIGN_VIEWER"]!=="undefined"){signViewer=params["SIGN_VIEWER"];}var headers=params["HEADERS"]||{};if(httpMethod==="POST"&&!headers["Content-Type"]){headers["Content-Type"]="application/x-www-form-urlencoded";}var urlParams=gadgets.util.getUrlParameters();var paramData={"url":url,"httpMethod":httpMethod,"headers":gadgets.io.encodeValues(headers,false),"postData":params["POST_DATA"]||"","authz":auth||"","st":st||"","contentType":params["CONTENT_TYPE"]||"TEXT","numEntries":params["NUM_ENTRIES"]||"3","getSummaries":!!params["GET_SUMMARIES"],"signOwner":signOwner,"signViewer":signViewer,"gadget":urlParams["url"],"container":urlParams["container"]||urlParams["synd"]||"default","bypassSpecCache":gadgets.util.getUrlParameters()["nocache"]||"","getFullHeaders":!!params["GET_FULL_HEADERS"]};if(auth==="oauth"||auth==="signed"||auth==="oauth2"){if(gadgets.io.oauthReceivedCallbackUrl_){paramData["OAUTH_RECEIVED_CALLBACK"]=gadgets.io.oauthReceivedCallbackUrl_;gadgets.io.oauthReceivedCallbackUrl_=null;}paramData["oauthState"]=oauthState||"";for(var opt in params){if(params.hasOwnProperty(opt)){if(opt.indexOf("OAUTH_")===0||opt==="code"){paramData[opt]=params[opt];}}}}st=st||shindig.auth.getSecurityToken();var opt_headers=st?{"X-Shindig-ST":st}:{};var proxyUrl=config["jsonProxyUrl"].replace("%host%",document.location.host);if(!respondWithPreload(paramData,params,callback)){if(httpMethod=="GET"&&typeof(refreshInterval)!="undefined"){paramData["refresh"]=refreshInterval;}if(httpMethod==="GET"&&!paramData["authz"]){var extraparams="?"+gadgets.io.encodeValues(paramData);makeXhrRequest(url,proxyUrl+extraparams,callback,null,"GET",params,processResponse,opt_headers);}else{var extraparams=gadgets.io.encodeValues(paramData);makeXhrRequest(url,proxyUrl,callback,extraparams,"POST",params,processResponse,opt_headers);}}},makeNonProxiedRequest:function(relativeUrl,callback,opt_params,opt_headers){var params=opt_params||{};makeXhrRequest(relativeUrl,relativeUrl,callback,params["POST_DATA"],params["METHOD"],params,processNonProxiedResponse,opt_headers);},clearOAuthState:function(){oauthState=undefined;},encodeValues:function(fields,opt_noEscaping){var escape=!opt_noEscaping;var buf=[];var first=false;for(var i in fields){if(fields.hasOwnProperty(i)&&!/___$/.test(i)){if(!first){first=true;}else{buf.push("&");}buf.push(escape?encodeURIComponent(i):i);buf.push("=");buf.push(escape?encodeURIComponent(fields[i]):fields[i]);}}return buf.join("");},getProxyUrl:function(url,opt_params){var proxyUrl=config["proxyUrl"];if(!proxyUrl){return proxyUrl;}var params=opt_params||{};var refresh=params["REFRESH_INTERVAL"];if(typeof refresh=="undefined"){refresh="3600";}var urlParams=gadgets.util.getUrlParameters();var st=shindig.auth.getSecurityToken();var authz=params[gadgets.io.RequestParameters.AUTHORIZATION];var serviceName=params[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME];var rewriteMimeParam=params["rewriteMime"]?"&rewriteMime="+encodeURIComponent(params["rewriteMime"]):"";var authParam="";if(authz){if(authz==gadgets.io.AuthorizationType.OAUTH||authz==gadgets.io.AuthorizationType.OAUTH2){authParam="&authz="+authz.toLowerCase()+"&st="+encodeURIComponent(st)+"&OAUTH_SERVICE_NAME="+encodeURIComponent(serviceName);}else{authParam="&authz="+authz.toLowerCase();}}var ret=proxyUrl.replace("%url%",encodeURIComponent(url)).replace("%host%",document.location.host).replace("%rawurl%",url).replace("%refresh%",encodeURIComponent(refresh)).replace("%gadget%",encodeURIComponent(urlParams["url"])).replace("%container%",encodeURIComponent(urlParams["container"]||urlParams["synd"]||"default")).replace("%authz%",authParam).replace("%rewriteMime%",rewriteMimeParam);if(ret.indexOf("//")==0){ret=window.location.protocol+ret;}return ret;},processResponse_:processResponse};}();gadgets.io.RequestParameters=gadgets.util.makeEnum(["METHOD","CONTENT_TYPE","POST_DATA","HEADERS","AUTHORIZATION","NUM_ENTRIES","GET_SUMMARIES","GET_FULL_HEADERS","REFRESH_INTERVAL","SIGN_OWNER","SIGN_VIEWER","OAUTH_SERVICE_NAME","OAUTH_USE_TOKEN","OAUTH_TOKEN_NAME","OAUTH_REQUEST_TOKEN","OAUTH_REQUEST_TOKEN_SECRET","OAUTH_RECEIVED_CALLBACK"]);gadgets.io.MethodType=gadgets.util.makeEnum(["GET","POST","PUT","DELETE","HEAD"]);gadgets.io.ContentType=gadgets.util.makeEnum(["TEXT","DOM","JSON","FEED"]);gadgets.io.AuthorizationType=gadgets.util.makeEnum(["NONE","SIGNED","OAUTH","OAUTH2"]);
tamings___.push(function(imports){caja___.whitelistFuncs([[gadgets.io,"encodeValues"],[gadgets.io,"getProxyUrl"],[gadgets.io,"makeRequest"]]);});
gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.wpm){gadgets.rpctx.wpm=function(){var process,ready;var forceSecure=true;function attachBrowserEvent(eventName,callback,useCapture){if(typeof window.addEventListener!="undefined"){window.addEventListener(eventName,callback,useCapture);}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("on"+eventName,callback);}}}function removeBrowserEvent(eventName,callback,useCapture){if(window.removeEventListener){window.removeEventListener(eventName,callback,useCapture);}else{if(window.detachEvent){window.detachEvent("on"+eventName,callback);}}}function onmessage(packet){var rpc=gadgets.json.parse(packet.data);if(!rpc||!rpc["f"]){return;}var origin=gadgets.rpc.getTargetOrigin(rpc["f"]);if(forceSecure&&(typeof packet.origin!=="undefined"?packet.origin!==origin:packet.domain!==/^.+:\/\/([^:]+).*/.exec(origin)[1])){return;}process(rpc,packet.origin);}return{getCode:function(){return"wpm";},isParentVerifiable:function(){return true;},init:function(processFn,readyFn){function configure(config){var cfg=config?config["rpc"]:{};if(String(cfg["disableForceSecure"])==="true"){forceSecure=false;}}gadgets.config.register("rpc",null,configure);process=processFn;ready=readyFn;attachBrowserEvent("message",onmessage,false);ready("..",true);return true;},setup:function(receiverId,token){ready(receiverId,true);return true;},call:function(targetId,from,rpc){var origin=gadgets.rpc.getTargetOrigin(targetId);var targetWin=gadgets.rpc._getTargetWin(targetId);if(origin){window.setTimeout(function(){targetWin.postMessage(gadgets.json.stringify(rpc),origin);},0);}else{gadgets.error("No relay set (used as window.postMessage targetOrigin)"+", cannot send cross-domain message");}return true;}};}();}
gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.flash){gadgets.rpctx.flash=function(){var swfId="___xpcswf";var swfUrl=null;var usingFlash=false;var processFn=null;var readyFn=null;var relayHandle=null;var LOADER_TIMEOUT_MS=100;var MAX_LOADER_RETRIES=50;var pendingHandshakes=[];var flushHandshakesHandle=null;var FLUSH_HANDSHAKES_TIMEOUT_MS=500;var setupHandle=null;var setupAttempts=0;var SWF_CHANNEL_READY="_scr";var SWF_CONFIRMED_PARENT="_pnt";var READY_TIMEOUT_MS=100;var MAX_READY_RETRIES=50;var readyAttempts=0;var readyHandle=null;var readyMsgs={};var myLoc=window.location.protocol+"//"+window.location.host;var JSL_NS="___jsl";var METHODS_NS="_fm";var bucketNs;function setupMethodBucket(){window[JSL_NS]=window[JSL_NS]||{};var container=window[JSL_NS];var bucket=container[METHODS_NS]={};bucketNs=JSL_NS+"."+METHODS_NS;return bucket;}var methodBucket=setupMethodBucket();function exportMethod(method,requestedName){var exported=function(){method.apply({},arguments);};methodBucket[requestedName]=methodBucket[requestedName]||exported;return bucketNs+"."+requestedName;}function getChannelId(receiverId){return receiverId===".."?gadgets.rpc.RPC_ID:receiverId;}function getRoleId(targetId){return targetId===".."?"INNER":"OUTER";}function init(config){if(usingFlash){swfUrl=config["rpc"]["commSwf"]||"//xpc.googleusercontent.com/gadgets/xpc.swf";}}gadgets.config.register("rpc",null,init);function relayLoader(){if(relayHandle===null&&document.body&&swfUrl){var theSwf=swfUrl+"?cb="+Math.random()+"&origin="+myLoc+"&jsl=1";var containerDiv=document.createElement("div");containerDiv.style.height="1px";containerDiv.style.width="1px";var html='<object height="1" width="1" id="'+swfId+'" type="application/x-shockwave-flash">'+'<param name="allowScriptAccess" value="always"></param>'+'<param name="movie" value="'+theSwf+'"></param>'+'<embed type="application/x-shockwave-flash" allowScriptAccess="always" '+'src="'+theSwf+'" height="1" width="1"></embed>'+"</object>";document.body.appendChild(containerDiv);containerDiv.innerHTML=html;relayHandle=containerDiv.firstChild;}++setupAttempts;if(setupHandle!==null&&(relayHandle!==null||setupAttempts>=MAX_LOADER_RETRIES)){window.clearTimeout(setupHandle);}else{setupHandle=window.setTimeout(relayLoader,LOADER_TIMEOUT_MS);}}function childReadyPoller(){if(readyMsgs[".."]){return;}sendChannelReady("..");readyAttempts++;if(readyAttempts>=MAX_READY_RETRIES&&readyHandle!==null){window.clearTimeout(readyHandle);readyHandle=null;}else{readyHandle=window.setTimeout(childReadyPoller,READY_TIMEOUT_MS);}}function flushHandshakes(){if(relayHandle!==null&&relayHandle["setup"]){while(pendingHandshakes.length>0){var shake=pendingHandshakes.shift();var targetId=shake.targetId;relayHandle["setup"](shake.token,getChannelId(targetId),getRoleId(targetId));}if(flushHandshakesHandle!==null){window.clearTimeout(flushHandshakesHandle);flushHandshakesHandle=null;}}else{if(flushHandshakesHandle===null&&pendingHandshakes.length>0){flushHandshakesHandle=window.setTimeout(flushHandshakes,FLUSH_HANDSHAKES_TIMEOUT_MS);}}}function ready(){flushHandshakes();if(setupHandle!==null){window.clearTimeout(setupHandle);}setupHandle=null;}exportMethod(ready,"ready");function setupDone(){if(!readyMsgs[".."]&&readyHandle===null){readyHandle=window.setTimeout(childReadyPoller,READY_TIMEOUT_MS);}}exportMethod(setupDone,"setupDone");function call(targetId,from,rpc){var targetOrigin=gadgets.rpc.getTargetOrigin(targetId);var rpcKey=gadgets.rpc.getAuthToken(targetId);var handleKey="sendMessage_"+getChannelId(targetId)+"_"+rpcKey+"_"+getRoleId(targetId);var messageHandler=relayHandle[handleKey];messageHandler.call(relayHandle,gadgets.json.stringify(rpc),targetOrigin);return true;}function receiveMessage(message,fromOrigin,toOrigin){var jsonMsg=gadgets.json.parse(message);var channelReady=jsonMsg[SWF_CHANNEL_READY];if(channelReady){readyFn(channelReady,true);readyMsgs[channelReady]=true;if(channelReady!==".."){sendChannelReady(channelReady,true);}return;}window.setTimeout(function(){processFn(jsonMsg,fromOrigin);},0);}exportMethod(receiveMessage,"receiveMessage");function sendChannelReady(receiverId,opt_isParentConfirmation){var myId=gadgets.rpc.RPC_ID;var readyAck={};readyAck[SWF_CHANNEL_READY]=opt_isParentConfirmation?"..":myId;readyAck[SWF_CONFIRMED_PARENT]=myId;call(receiverId,myId,readyAck);}return{getCode:function(){return"flash";},isParentVerifiable:function(){return true;},init:function(processIn,readyIn){processFn=processIn;readyFn=readyIn;usingFlash=true;return true;},setup:function(receiverId,token){pendingHandshakes.push({token:token,targetId:receiverId});if(relayHandle===null&&setupHandle===null){setupHandle=window.setTimeout(relayLoader,LOADER_TIMEOUT_MS);}flushHandshakes();return true;},call:call,_receiveMessage:receiveMessage,_ready:ready,_setupDone:setupDone};}();}
gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.frameElement){gadgets.rpctx.frameElement=function(){var FE_G2C_CHANNEL="__g2c_rpc";var FE_C2G_CHANNEL="__c2g_rpc";var process;var ready;function callFrameElement(targetId,from,rpc){try{if(from!==".."){var fe=window.frameElement;if(typeof fe[FE_G2C_CHANNEL]==="function"){if(typeof fe[FE_G2C_CHANNEL][FE_C2G_CHANNEL]!=="function"){fe[FE_G2C_CHANNEL][FE_C2G_CHANNEL]=function(args){process(gadgets.json.parse(args));};}fe[FE_G2C_CHANNEL](gadgets.json.stringify(rpc));return true;}}else{var frame=document.getElementById(targetId);if(typeof frame[FE_G2C_CHANNEL]==="function"&&typeof frame[FE_G2C_CHANNEL][FE_C2G_CHANNEL]==="function"){frame[FE_G2C_CHANNEL][FE_C2G_CHANNEL](gadgets.json.stringify(rpc));return true;}}}catch(e){}return false;}return{getCode:function(){return"fe";},isParentVerifiable:function(){return false;},init:function(processFn,readyFn){process=processFn;ready=readyFn;return true;},setup:function(receiverId,token){if(receiverId!==".."){try{var frame=document.getElementById(receiverId);frame[FE_G2C_CHANNEL]=function(args){process(gadgets.json.parse(args));};}catch(e){return false;}}if(receiverId===".."){ready("..",true);var ackFn=function(){window.setTimeout(function(){gadgets.rpc.call(receiverId,gadgets.rpc.ACK);},500);};gadgets.util.registerOnLoadHandler(ackFn);}return true;},call:function(targetId,from,rpc){return callFrameElement(targetId,from,rpc);}};}();}
gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.nix){gadgets.rpctx.nix=function(){var NIX_WRAPPER="GRPC____NIXVBS_wrapper";var NIX_GET_WRAPPER="GRPC____NIXVBS_get_wrapper";var NIX_HANDLE_MESSAGE="GRPC____NIXVBS_handle_message";var NIX_CREATE_CHANNEL="GRPC____NIXVBS_create_channel";var MAX_NIX_SEARCHES=10;var NIX_SEARCH_PERIOD=500;var nix_channels={};var ready;var numHandlerSearches=0;function conductHandlerSearch(){var handler=nix_channels[".."];if(handler){return;}if(++numHandlerSearches>MAX_NIX_SEARCHES){gadgets.warn("Nix transport setup failed, falling back...");ready("..",false);return;}if(!handler&&window.opener&&"GetAuthToken" in window.opener){handler=window.opener;if(handler.GetAuthToken()==gadgets.rpc.getAuthToken("..")){var token=gadgets.rpc.getAuthToken("..");handler.CreateChannel(window[NIX_GET_WRAPPER]("..",token),token);nix_channels[".."]=handler;window.opener=null;ready("..",true);return;}}window.setTimeout(function(){conductHandlerSearch();},NIX_SEARCH_PERIOD);}return{getCode:function(){return"nix";},isParentVerifiable:function(){return false;},init:function(processFn,readyFn){ready=readyFn;if(typeof window[NIX_GET_WRAPPER]!=="unknown"){window[NIX_HANDLE_MESSAGE]=function(data){window.setTimeout(function(){processFn(gadgets.json.parse(data));},0);};window[NIX_CREATE_CHANNEL]=function(name,channel,token){if(gadgets.rpc.getAuthToken(name)===token){nix_channels[name]=channel;ready(name,true);}};var vbscript="Class "+NIX_WRAPPER+"\n "+"Private m_Intended\n"+"Private m_Auth\n"+"Public Sub SetIntendedName(name)\n "+"If isEmpty(m_Intended) Then\n"+"m_Intended = name\n"+"End If\n"+"End Sub\n"+"Public Sub SetAuth(auth)\n "+"If isEmpty(m_Auth) Then\n"+"m_Auth = auth\n"+"End If\n"+"End Sub\n"+"Public Sub SendMessage(data)\n "+NIX_HANDLE_MESSAGE+"(data)\n"+"End Sub\n"+"Public Function GetAuthToken()\n "+"GetAuthToken = m_Auth\n"+"End Function\n"+"Public Sub CreateChannel(channel, auth)\n "+"Call "+NIX_CREATE_CHANNEL+"(m_Intended, channel, auth)\n"+"End Sub\n"+"End Class\n"+"Function "+NIX_GET_WRAPPER+"(name, auth)\n"+"Dim wrap\n"+"Set wrap = New "+NIX_WRAPPER+"\n"+"wrap.SetIntendedName name\n"+"wrap.SetAuth auth\n"+"Set "+NIX_GET_WRAPPER+" = wrap\n"+"End Function";try{window.execScript(vbscript,"vbscript");}catch(e){return false;}}return true;},setup:function(receiverId,token){if(receiverId===".."){conductHandlerSearch();return true;}try{var frame=document.getElementById(receiverId);var wrapper=window[NIX_GET_WRAPPER](receiverId,token);frame.contentWindow.opener=wrapper;}catch(e){return false;}return true;},call:function(targetId,from,rpc){try{if(nix_channels[targetId]){nix_channels[targetId].SendMessage(gadgets.json.stringify(rpc));}}catch(e){return false;}return true;}};}();}
gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.rmr){gadgets.rpctx.rmr=function(){var RMR_SEARCH_TIMEOUT=500;var RMR_MAX_POLLS=10;var rmr_channels={};var parentParam=gadgets.util.getUrlParameters()["parent"];var process;var ready;function appendRmrFrame(channelFrame,relayUri,data,opt_frameId){var appendFn=function(){document.body.appendChild(channelFrame);channelFrame.src="about:blank";if(opt_frameId){channelFrame.onload=function(){processRmrData(opt_frameId);};}channelFrame.src=relayUri+"#"+data;};if(document.body){appendFn();}else{gadgets.util.registerOnLoadHandler(function(){appendFn();});}}function setupRmr(frameId){if(typeof rmr_channels[frameId]==="object"){return;}var channelFrame=document.createElement("iframe");var frameStyle=channelFrame.style;frameStyle.position="absolute";frameStyle.top="0px";frameStyle.border="0";frameStyle.opacity="0";frameStyle.width="10px";frameStyle.height="1px";channelFrame.id="rmrtransport-"+frameId;channelFrame.name=channelFrame.id;var relayUri=gadgets.rpc.getRelayUrl(frameId);var relayOrigin=gadgets.rpc.getOrigin(parentParam);if(!relayUri){relayUri=relayOrigin+"/robots.txt";}rmr_channels[frameId]={frame:channelFrame,receiveWindow:null,relayUri:relayUri,relayOrigin:relayOrigin,searchCounter:0,width:10,waiting:true,queue:[],sendId:0,recvId:0,verifySendToken:String(Math.random()),verifyRecvToken:null,originVerified:false};if(frameId!==".."){appendRmrFrame(channelFrame,relayUri,getRmrData(frameId));}conductRmrSearch(frameId);}function conductRmrSearch(frameId){var channelWindow=null;rmr_channels[frameId].searchCounter++;try{var targetWin=gadgets.rpc._getTargetWin(frameId);if(frameId===".."){channelWindow=targetWin.frames["rmrtransport-"+gadgets.rpc.RPC_ID];}else{channelWindow=targetWin.frames["rmrtransport-.."];}}catch(e){}var status=false;if(channelWindow){status=registerRmrChannel(frameId,channelWindow);}if(!status){if(rmr_channels[frameId].searchCounter>RMR_MAX_POLLS){return;}window.setTimeout(function(){conductRmrSearch(frameId);},RMR_SEARCH_TIMEOUT);}}function callRmr(targetId,serviceName,from,rpc){var handler=null;if(from!==".."){handler=rmr_channels[".."];}else{handler=rmr_channels[targetId];}if(handler){if(serviceName!==gadgets.rpc.ACK){handler.queue.push(rpc);}if(handler.waiting||(handler.queue.length===0&&!(serviceName===gadgets.rpc.ACK&&rpc&&rpc["ackAlone"]===true))){return true;}if(handler.queue.length>0){handler.waiting=true;}var url=handler.relayUri+"#"+getRmrData(targetId);try{handler.frame.contentWindow.location=url;var newWidth=handler.width==10?20:10;handler.frame.style.width=newWidth+"px";handler.width=newWidth;}catch(e){return false;}}return true;}function getRmrData(toFrameId){var channel=rmr_channels[toFrameId];var rmrData={id:channel.sendId};if(channel){rmrData["d"]=Array.prototype.slice.call(channel.queue,0);var ackPacket={"s":gadgets.rpc.ACK,"id":channel.recvId};if(!channel.originVerified){ackPacket["sendToken"]=channel.verifySendToken;}if(channel.verifyRecvToken){ackPacket["recvToken"]=channel.verifyRecvToken;}rmrData["d"].push(ackPacket);}return gadgets.json.stringify(rmrData);}function processRmrData(fromFrameId){var channel=rmr_channels[fromFrameId];var data=channel.receiveWindow.location.hash.substring(1);var rpcObj=gadgets.json.parse(decodeURIComponent(data))||{};var rpcArray=rpcObj["d"]||[];var nonAckReceived=false;var noLongerWaiting=false;var numBypassed=0;var numToBypass=(channel.recvId-rpcObj["id"]);for(var i=0;i<rpcArray.length;++i){var rpc=rpcArray[i];if(rpc["s"]===gadgets.rpc.ACK){ready(fromFrameId,true);channel.verifyRecvToken=rpc["sendToken"];if(!channel.originVerified&&rpc["recvToken"]&&String(rpc["recvToken"])==String(channel.verifySendToken)){channel.originVerified=true;}if(channel.waiting){noLongerWaiting=true;}channel.waiting=false;var newlyAcked=Math.max(0,rpc["id"]-channel.sendId);channel.queue.splice(0,newlyAcked);channel.sendId=Math.max(channel.sendId,rpc["id"]||0);continue;}nonAckReceived=true;if(++numBypassed<=numToBypass){continue;}++channel.recvId;process(rpc,channel.originVerified?channel.relayOrigin:undefined);}if(nonAckReceived||(noLongerWaiting&&channel.queue.length>0)){var from=(fromFrameId==="..")?gadgets.rpc.RPC_ID:"..";callRmr(fromFrameId,gadgets.rpc.ACK,from,{"ackAlone":nonAckReceived});}}function registerRmrChannel(frameId,channelWindow){var channel=rmr_channels[frameId];try{var canAccess=false;canAccess="document" in channelWindow;if(!canAccess){return false;}canAccess=typeof channelWindow["document"]=="object";if(!canAccess){return false;}var loc=channelWindow.location.href;if(loc==="about:blank"){return false;}}catch(ex){return false;}channel.receiveWindow=channelWindow;function onresize(){processRmrData(frameId);}if(typeof channelWindow.attachEvent==="undefined"){channelWindow.onresize=onresize;}else{channelWindow.attachEvent("onresize",onresize);}if(frameId===".."){appendRmrFrame(channel.frame,channel.relayUri,getRmrData(frameId),frameId);}else{processRmrData(frameId);}return true;}return{getCode:function(){return"rmr";},isParentVerifiable:function(){return true;},init:function(processFn,readyFn){process=processFn;ready=readyFn;return true;},setup:function(receiverId,token){try{setupRmr(receiverId);}catch(e){gadgets.warn("Caught exception setting up RMR: "+e);return false;}return true;},call:function(targetId,from,rpc){return callRmr(targetId,rpc["s"],from,rpc);}};}();}
gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.ifpc){gadgets.rpctx.ifpc=function(){var iframePool=[];var callId=0;var ready;var URL_LIMIT=2000;var messagesIn={};function encodeLegacyData(args){var argsEscaped=[];for(var i=0,j=args.length;i<j;++i){argsEscaped.push(encodeURIComponent(gadgets.json.stringify(args[i])));}return argsEscaped.join("&");}function emitInvisibleIframe(src){var iframe;for(var i=iframePool.length-1;i>=0;--i){var ifr=iframePool[i];try{if(ifr&&(ifr.recyclable||ifr.readyState==="complete")){ifr.parentNode.removeChild(ifr);if(window.ActiveXObject){iframePool[i]=ifr=null;iframePool.splice(i,1);}else{ifr.recyclable=false;iframe=ifr;break;}}}catch(e){}}if(!iframe){iframe=document.createElement("iframe");iframe.style.border=iframe.style.width=iframe.style.height="0px";iframe.style.visibility="hidden";iframe.style.position="absolute";iframe.onload=function(){this.recyclable=true;};iframePool.push(iframe);}iframe.src=src;window.setTimeout(function(){document.body.appendChild(iframe);},0);}function isMessageComplete(arr,total){for(var i=total-1;i>=0;--i){if(typeof arr[i]==="undefined"){return false;}}return true;}return{getCode:function(){return"ifpc";},isParentVerifiable:function(){return true;},init:function(processFn,readyFn){ready=readyFn;ready("..",true);return true;},setup:function(receiverId,token){ready(receiverId,true);return true;},call:function(targetId,from,rpc){var relay=gadgets.rpc.getRelayUrl(targetId);++callId;if(!relay){gadgets.warn("No relay file assigned for IFPC");return false;}var src=null,queueOut=[];if(rpc["l"]){var callArgs=rpc["a"];src=[relay,"#",encodeLegacyData([from,callId,1,0,encodeLegacyData([from,rpc["s"],"","",from].concat(callArgs))])].join("");queueOut.push(src);}else{src=[relay,"#",targetId,"&",from,"@",callId,"&"].join("");var message=encodeURIComponent(gadgets.json.stringify(rpc)),payloadLength=URL_LIMIT-src.length,numPackets=Math.ceil(message.length/payloadLength),packetIdx=0,part;while(message.length>0){part=message.substring(0,payloadLength);message=message.substring(payloadLength);queueOut.push([src,numPackets,"&",packetIdx,"&",part].join(""));packetIdx+=1;}}do{emitInvisibleIframe(queueOut.shift());}while(queueOut.length>0);return true;},_receiveMessage:function(fragment,process){var from=fragment[1],numPackets=parseInt(fragment[2],10),packetIdx=parseInt(fragment[3],10),payload=fragment[fragment.length-1],completed=numPackets===1;if(numPackets>1){if(!messagesIn[from]){messagesIn[from]=[];}messagesIn[from][packetIdx]=payload;if(isMessageComplete(messagesIn[from],numPackets)){payload=messagesIn[from].join("");delete messagesIn[from];completed=true;}}if(completed){process(gadgets.json.parse(decodeURIComponent(payload)));}}};}();}
if(!window["gadgets"]["rpc"]){gadgets.rpc=function(){var CALLBACK_NAME="__cb";var DEFAULT_NAME="";var ACK="__ack";var SETUP_FRAME_TIMEOUT=500;var SETUP_FRAME_MAX_TRIES=10;var ID_ORIGIN_DELIMITER="|";var RPC_KEY_CALLBACK="callback";var RPC_KEY_ORIGIN="origin";var RPC_KEY_REFERRER="referer";var services={};var relayUrl={};var useLegacyProtocol={};var authToken={};var callId=0;var callbacks={};var setup={};var sameDomain={};var params={};var receiverTx={};var earlyRpcQueue={};var passReferrerDirection=null;var passReferrerContents=null;var isChild=!!gadgets.util.getUrlParameters().parent&&(window.top!==window.self);var rpcId=window.name;var securityCallback=function(){};var arbitrator=null;var LOAD_TIMEOUT=0;var FRAME_PHISH=1;var FORGED_MSG=2;var console=window["console"];var clog=console&&console.log?function(msg){console.log(msg);}:function(){};var fallbackTransport=(function(){function logFn(name){return function(){clog(name+": call ignored");};}return{"getCode":function(){return"noop";},"isParentVerifiable":function(){return true;},"init":logFn("init"),"setup":logFn("setup"),"call":logFn("call")};})();if(gadgets.util){params=gadgets.util.getUrlParameters();}function getTransport(){if(params["rpctx"]=="flash"){return gadgets.rpctx.flash;}if(params["rpctx"]=="rmr"){return gadgets.rpctx.rmr;}return typeof window.postMessage==="function"?gadgets.rpctx.wpm:typeof window.postMessage==="object"?gadgets.rpctx.wpm:window.ActiveXObject?(gadgets.rpctx.flash?gadgets.rpctx.flash:gadgets.rpctx.nix):navigator.userAgent.indexOf("WebKit")>0?gadgets.rpctx.rmr:navigator.product==="Gecko"?gadgets.rpctx.frameElement:gadgets.rpctx.ifpc;}function transportReady(receiverId,readySuccess){if(receiverTx[receiverId]){return;}var tx=transport;if(!readySuccess){tx=fallbackTransport;}receiverTx[receiverId]=tx;var earlyQueue=earlyRpcQueue[receiverId]||[];for(var i=0;i<earlyQueue.length;++i){var rpc=earlyQueue[i];rpc["t"]=getAuthToken(receiverId);tx.call(receiverId,rpc["f"],rpc);}earlyRpcQueue[receiverId]=[];}var mainPageUnloading=false,hookedUnload=false;function hookMainPageUnload(){if(hookedUnload){return;}function onunload(){mainPageUnloading=true;}if(typeof window.addEventListener!="undefined"){window.addEventListener("unload",onunload,false);}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onunload",onunload);}}hookedUnload=true;}function relayOnload(targetId,sourceId,token,data,relayWindow){if(!authToken[sourceId]||authToken[sourceId]!==token){gadgets.error("Invalid auth token. "+authToken[sourceId]+" vs "+token);securityCallback(sourceId,FORGED_MSG);}relayWindow.onunload=function(){if(setup[sourceId]&&!mainPageUnloading){securityCallback(sourceId,FRAME_PHISH);gadgets.rpc.removeReceiver(sourceId);}};hookMainPageUnload();data=gadgets.json.parse(decodeURIComponent(data));}function process(rpc,opt_sender){if(rpc&&typeof rpc["s"]==="string"&&typeof rpc["f"]==="string"&&rpc["a"] instanceof Array){if(typeof arbitrate==="function"&&!arbitrate(rpc["s"],rpc["f"])){return;}if(authToken[rpc["f"]]){if(authToken[rpc["f"]]!==rpc["t"]){gadgets.error("Invalid auth token. "+authToken[rpc["f"]]+" vs "+rpc["t"]);securityCallback(rpc["f"],FORGED_MSG);}}if(rpc["s"]===ACK){window.setTimeout(function(){transportReady(rpc["f"],true);},0);return;}if(rpc["c"]){rpc[RPC_KEY_CALLBACK]=function(result){gadgets.rpc.call(rpc["f"],CALLBACK_NAME,null,rpc["c"],result);};}if(opt_sender){var origin=getOrigin(opt_sender);rpc[RPC_KEY_ORIGIN]=opt_sender;var referrer=rpc["r"];if(!referrer||getOrigin(referrer)!=origin){referrer=opt_sender;}rpc[RPC_KEY_REFERRER]=referrer;}var result=(services[rpc["s"]]||services[DEFAULT_NAME]).apply(rpc,rpc["a"]);if(rpc["c"]&&typeof result!=="undefined"){gadgets.rpc.call(rpc["f"],CALLBACK_NAME,null,rpc["c"],result);}}}function getOrigin(url){if(!url){return"";}url=url.toLowerCase();if(url.indexOf("//")==0){url=window.location.protocol+url;}if(url.indexOf("://")==-1){url=window.location.protocol+"//"+url;}var host=url.substring(url.indexOf("://")+3);var slashPos=host.indexOf("/");if(slashPos!=-1){host=host.substring(0,slashPos);}var protocol=url.substring(0,url.indexOf("://"));var portStr="";var portPos=host.indexOf(":");if(portPos!=-1){var port=host.substring(portPos+1);host=host.substring(0,portPos);if((protocol==="http"&&port!=="80")||(protocol==="https"&&port!=="443")){portStr=":"+port;}}return protocol+"://"+host+portStr;}function makeSiblingId(id,opt_origin){return"/"+id+(opt_origin?ID_ORIGIN_DELIMITER+opt_origin:"");}function parseSiblingId(id){if(id.charAt(0)=="/"){var delimiter=id.indexOf(ID_ORIGIN_DELIMITER);var siblingId=delimiter>0?id.substring(1,delimiter):id.substring(1);var origin=delimiter>0?id.substring(delimiter+1):null;return{id:siblingId,origin:origin};}else{return null;}}function getTargetWin(id){if(typeof id==="undefined"||id===".."){return window.parent;}var siblingId=parseSiblingId(id);if(siblingId){return window.frames[siblingId.id];}id=String(id);var target=document.getElementById(id);if(target&&target.contentWindow){return target.contentWindow;}target=window.frames[id];if(target&&!target.closed){return target;}return null;}function getTargetOrigin(id){var targetRelay=null;var relayUrl=getRelayUrl(id);if(relayUrl){targetRelay=relayUrl;}else{var siblingId=parseSiblingId(id);if(siblingId){targetRelay=siblingId.origin;}else{if(id==".."){targetRelay=params["parent"];}else{targetRelay=document.getElementById(id).src;}}}return getOrigin(targetRelay);}var transport=getTransport();services[DEFAULT_NAME]=function(){clog("Unknown RPC service: "+this.s);};services[CALLBACK_NAME]=function(callbackId,result){var callback=callbacks[callbackId];if(callback){delete callbacks[callbackId];callback.call(this,result);}};function setupFrame(frameId,token){if(setup[frameId]===true){return;}if(typeof setup[frameId]==="undefined"){setup[frameId]=0;}var tgtFrame=getTargetWin(frameId);if(frameId===".."||tgtFrame!=null){if(transport.setup(frameId,token)===true){setup[frameId]=true;return;}}if(setup[frameId]!==true&&setup[frameId]++<SETUP_FRAME_MAX_TRIES){window.setTimeout(function(){setupFrame(frameId,token);},SETUP_FRAME_TIMEOUT);}else{receiverTx[frameId]=fallbackTransport;setup[frameId]=true;}}var _flagCrossOrigin={};function callSameDomain(target,rpc){var targetEl=getTargetWin(target);if(!sameDomain[target]||(sameDomain[target]!==_flagCrossOrigin&&targetEl.Function.prototype!==sameDomain[target].constructor.prototype)){var targetRelay=getRelayUrl(target);if(getOrigin(targetRelay)!==getOrigin(window.location.href)){sameDomain[target]=_flagCrossOrigin;return false;}try{var targetGadgets=targetEl["gadgets"];sameDomain[target]=targetGadgets.rpc.receiveSameDomain;}catch(e){sameDomain[target]=_flagCrossOrigin;return false;}}if(sameDomain[target]&&sameDomain[target]!==_flagCrossOrigin){sameDomain[target](rpc);return true;}return false;}function getRelayUrl(targetId){var url=relayUrl[targetId];if(url&&url.substring(0,1)==="/"){if(url.substring(1,2)==="/"){url=document.location.protocol+url;}else{url=document.location.protocol+"//"+document.location.host+url;}}return url;}function setRelayUrl(targetId,url,opt_useLegacy){if(!/http(s)?:\/\/.+/.test(url)){if(url.indexOf("//")==0){url=window.location.protocol+url;}else{if(url.charAt(0)=="/"){url=window.location.protocol+"//"+window.location.host+url;}else{if(url.indexOf("://")==-1){url=window.location.protocol+"//"+url;}}}}relayUrl[targetId]=url;if(typeof opt_useLegacy!=="undefined"){useLegacyProtocol[targetId]=!!opt_useLegacy;}}function getAuthToken(targetId){return authToken[targetId];}function setAuthToken(targetId,token){token=token||"";authToken[targetId]=String(token);setupFrame(targetId,token);}function setReferrerConfig(cfg){var passReferrer=cfg["passReferrer"]||"";var prParts=passReferrer.split(":",2);passReferrerDirection=prParts[0]||"none";passReferrerContents=prParts[1]||"origin";}function setLegacyProtocolConfig(cfg){if(isLegacyProtocolConfig(cfg)){transport=gadgets.rpctx.ifpc;transport.init(process,transportReady);}}function isLegacyProtocolConfig(cfg){return String(cfg["useLegacyProtocol"])==="true";}function setupContainedContext(rpctoken,opt_parent){function init(config){var cfg=config?config["rpc"]:{};setReferrerConfig(cfg);var parentRelayUrl=cfg["parentRelayUrl"]||"";parentRelayUrl=getOrigin(params["parent"]||opt_parent)+parentRelayUrl;setRelayUrl("..",parentRelayUrl,isLegacyProtocolConfig(cfg));setLegacyProtocolConfig(cfg);setAuthToken("..",rpctoken);}if(!params["parent"]&&opt_parent){init({});return;}gadgets.config.register("rpc",null,init);}function setupChildIframe(gadgetId,opt_frameurl,opt_authtoken){var childIframe=null;if(gadgetId.charAt(0)!="/"){if(!gadgets.util){return;}childIframe=document.getElementById(gadgetId);if(!childIframe){throw new Error("Cannot set up gadgets.rpc receiver with ID: "+gadgetId+", element not found.");}}var childSrc=childIframe&&childIframe.src;var relayUrl=opt_frameurl||gadgets.rpc.getOrigin(childSrc);setRelayUrl(gadgetId,relayUrl);var childParams=gadgets.util.getUrlParameters(childSrc);var rpctoken=opt_authtoken||childParams["rpctoken"];setAuthToken(gadgetId,rpctoken);}function setupReceiver(targetId,opt_receiverurl,opt_authtoken){if(targetId===".."){var rpctoken=opt_authtoken||params["rpctoken"]||params["ifpctok"]||"";setupContainedContext(rpctoken,opt_receiverurl);}else{setupChildIframe(targetId,opt_receiverurl,opt_authtoken);}}function getReferrer(targetId){if(passReferrerDirection==="bidir"||(passReferrerDirection==="c2p"&&targetId==="..")||(passReferrerDirection==="p2c"&&targetId!=="..")){var href=window.location.href;var lopOff="?";if(passReferrerContents==="query"){lopOff="#";}else{if(passReferrerContents==="hash"){return href;}}var lastIx=href.lastIndexOf(lopOff);lastIx=lastIx===-1?href.length:lastIx;return href.substring(0,lastIx);}return null;}return{config:function(config){if(typeof config.securityCallback==="function"){securityCallback=config.securityCallback;}if(typeof config.arbitrator==="function"){arbitrate=config.arbitrator;}},register:function(serviceName,handler){if(serviceName===CALLBACK_NAME||serviceName===ACK){throw new Error("Cannot overwrite callback/ack service");}if(serviceName===DEFAULT_NAME){throw new Error("Cannot overwrite default service:"+" use registerDefault");}var old=services[serviceName];services[serviceName]=handler;return old;},unregister:function(serviceName){if(serviceName===CALLBACK_NAME||serviceName===ACK){throw new Error("Cannot delete callback/ack service");}if(serviceName===DEFAULT_NAME){throw new Error("Cannot delete default service:"+" use unregisterDefault");}delete services[serviceName];},registerDefault:function(handler){services[DEFAULT_NAME]=handler;},unregisterDefault:function(){delete services[DEFAULT_NAME];},forceParentVerifiable:function(){if(!transport.isParentVerifiable()){transport=gadgets.rpctx.ifpc;}},call:function(targetId,serviceName,callback,var_args){targetId=targetId||"..";var from="..";if(targetId===".."){from=rpcId;}else{if(targetId.charAt(0)=="/"){from=makeSiblingId(rpcId,gadgets.rpc.getOrigin(window.location.href));}}++callId;if(callback){callbacks[callId]=callback;}var rpc={"s":serviceName,"f":from,"c":callback?callId:0,"a":Array.prototype.slice.call(arguments,3),"t":authToken[targetId],"l":!!useLegacyProtocol[targetId]};var referrer=getReferrer(targetId);if(referrer){rpc["r"]=referrer;}if(targetId!==".."&&parseSiblingId(targetId)==null&&!document.getElementById(targetId)){return;}if(callSameDomain(targetId,rpc)){return;}var channel=receiverTx[targetId];if(!channel&&parseSiblingId(targetId)!==null){channel=transport;}if(!channel){if(!earlyRpcQueue[targetId]){earlyRpcQueue[targetId]=[rpc];}else{earlyRpcQueue[targetId].push(rpc);}return;}if(useLegacyProtocol[targetId]){channel=gadgets.rpctx.ifpc;}if(channel.call(targetId,from,rpc)===false){receiverTx[targetId]=fallbackTransport;transport.call(targetId,from,rpc);}},getRelayUrl:getRelayUrl,setRelayUrl:setRelayUrl,setAuthToken:setAuthToken,setupReceiver:setupReceiver,getAuthToken:getAuthToken,removeReceiver:function(receiverId){delete relayUrl[receiverId];delete useLegacyProtocol[receiverId];delete authToken[receiverId];delete setup[receiverId];delete sameDomain[receiverId];delete receiverTx[receiverId];},getRelayChannel:function(){return transport.getCode();},receive:function(fragment,otherWindow){if(fragment.length>4){transport._receiveMessage(fragment,process);}else{relayOnload.apply(null,fragment.concat(otherWindow));}},receiveSameDomain:function(rpc){rpc["a"]=Array.prototype.slice.call(rpc["a"]);window.setTimeout(function(){process(rpc);},0);},getOrigin:getOrigin,getTargetOrigin:getTargetOrigin,init:function(){if(transport.init(process,transportReady)===false){transport=fallbackTransport;}if(isChild){setupReceiver("..");}else{gadgets.config.register("rpc",null,function(config){var cfg=config["rpc"]||{};setReferrerConfig(cfg);setLegacyProtocolConfig(cfg);});}},_getTargetWin:getTargetWin,_parseSiblingId:parseSiblingId,ACK:ACK,RPC_ID:rpcId||"..",SEC_ERROR_LOAD_TIMEOUT:LOAD_TIMEOUT,SEC_ERROR_FRAME_PHISH:FRAME_PHISH,SEC_ERROR_FORGED_MSG:FORGED_MSG};}();gadgets.rpc.init();}
(function(){var newBatch=function(){var that={};var keyedRequests=[];var add=function(key,request){if(request&&key){keyedRequests.push({"key":key,"request":request});}return that;};var toJsonRpc=function(request){var jsonRpc={"method":request["request"]["method"],"id":request["key"]};if(request["request"]["rpc"]){jsonRpc["params"]=request["request"]["rpc"];}return jsonRpc;};var execute=function(userCallback){var batchResult={};var perTransportBatch={};var latchCount=0;var transports=[];for(var i=0;i<keyedRequests.length;i++){var transport=keyedRequests[i]["request"]["transport"];if(!perTransportBatch[transport["name"]]){transports.push(transport);latchCount++;}perTransportBatch[transport["name"]]=perTransportBatch[transport["name"]]||[];perTransportBatch[transport["name"]].push(toJsonRpc(keyedRequests[i]));}var transportCallback=function(transportBatchResult){if(transportBatchResult["error"]){batchResult["error"]=transportBatchResult["error"];}for(var i=0;i<keyedRequests.length;i++){var key=keyedRequests[i]["key"];var response=transportBatchResult[key];if(response){if(response["error"]){batchResult[key]=response;}else{batchResult[key]=response["data"]||response["result"];}}}latchCount--;if(latchCount===0){userCallback(batchResult);}};for(var j=0;j<transports.length;j++){transports[j].execute(perTransportBatch[transports[j]["name"]],transportCallback);}if(latchCount==0){window.setTimeout(function(){userCallback(batchResult);},0);}};that.execute=execute;that.add=add;return that;};osapi.newBatch=newBatch;})();
osapi._registerMethod=function(method,transport){if(method==="newBatch"){return;}var parts=method.split(".");var last=osapi;for(var i=0;i<parts.length-1;i++){last[parts[i]]=last[parts[i]]||{};last=last[parts[i]];}var basename=parts[parts.length-1],old;if(last[basename]){old=last[basename];}last[basename]=function(rpc){rpc=rpc||{};rpc["userId"]=rpc["userId"]||"@viewer";rpc["groupId"]=rpc["groupId"]||"@self";var boundCall=new osapi._BoundCall(method,transport,rpc);return boundCall;};if(typeof tamings___!=="undefined"){var newTaming=function(){caja___.markFunction(last[basename],method);};if(old&&old.__taming_index){last[basename].__taming_index=old.__taming_index;tamings___[old.__taming_index]=newTaming;}else{last[basename].__taming_index=tamings___.length;tamings___.push(newTaming);}}};osapi._BoundCall=function(method,transport,rpc){this["method"]=method;this["transport"]=transport;this["rpc"]=rpc;};osapi._BoundCall.prototype.execute=function(callback){var cajaReady=(typeof caja___!=="undefined"&&caja___.getUseless&&caja___.getUseless());var that=cajaReady?caja___.getUseless():this;var feralCallback=cajaReady?caja___.untame(callback):callback;var batch=osapi.newBatch();batch.add(this.method,this);batch.execute(function(batchResult){if(batchResult.error){feralCallback.call(that,{error:batchResult.error});}else{feralCallback.call(that,batchResult[that.method]);}});};
tamings___.push(function(imports){function newBatch(){var batch=osapi.newBatch();caja___.whitelistFuncs([[batch,"add"],[batch,"execute"]]);return caja___.tame(batch);}caja___.markFunction(newBatch,"newBatch");caja___.tamesTo(osapi.newBatch,newBatch);caja___.whitelistCtors([[osapi,"_BoundCall",Object]]);caja___.whitelistMeths([[osapi._BoundCall,"execute"]]);});
(function(){var useOAuth2;function execute(requests,callback){function processResponse(response){if(response["errors"][0]){callback({error:{"code":response["rc"],"message":response["text"]}});}else{var jsonResponse=response["result"]||response["data"];if(jsonResponse["error"]){callback(jsonResponse);}else{var responseMap={};for(var i=0;i<jsonResponse.length;i++){responseMap[jsonResponse[i]["id"]]=jsonResponse[i];}callback(responseMap);}}}var request={"POST_DATA":gadgets.json.stringify(requests),"CONTENT_TYPE":"JSON","METHOD":"POST","AUTHORIZATION":"SIGNED"};var headers={"Content-Type":"application/json"};var url=this.name;var token=shindig.auth.getSecurityToken();if(token){if(useOAuth2){headers["Authorization"]="OAuth2 "+token;}else{url+="?st=";url+=encodeURIComponent(token);}}gadgets.io.makeNonProxiedRequest(url,processResponse,request,headers);}function init(config){var services=config["osapi.services"];useOAuth2=config["osapi.useOAuth2"];if(services){for(var endpointName in services){if(services.hasOwnProperty(endpointName)){if(endpointName.indexOf("http")==0||endpointName.indexOf("//")==0){var endpointUrl=endpointName.replace("%host%",document.location.host);var transport={"name":endpointUrl,"execute":execute};var methods=services[endpointName];for(var i=0;i<methods.length;i++){osapi._registerMethod(methods[i],transport);}}}}}}if(gadgets.config){gadgets.config.register("osapi.services",null,init);}})();
gadgets.util.registerOnLoadHandler(function(){if(osapi&&osapi.people&&osapi.people.get){osapi.people.getViewer=function(options){options=options||{};options.userId="@viewer";options.groupId="@self";return osapi.people.get(options);};osapi.people.getViewerFriends=function(options){options=options||{};options.userId="@viewer";options.groupId="@friends";return osapi.people.get(options);};osapi.people.getOwner=function(options){options=options||{};options.userId="@owner";options.groupId="@self";return osapi.people.get(options);};osapi.people.getOwnerFriends=function(options){options=options||{};options.userId="@owner";options.groupId="@friends";return osapi.people.get(options);};}});
tamings___.push(function(imports){var savedImports=imports;gadgets.util.registerOnLoadHandler(function(){if(osapi&&osapi.people&&osapi.people.get){caja___.whitelistFuncs([[osapi.people,"getViewer"],[osapi.people,"getViewerFriends"],[osapi.people,"getOwner"],[osapi.people,"getOwnerFriends"]]);}});});
shindig.uri=(function(){var PARSE_REGEX=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?");return function(opt_in){var schema_="";var authority_="";var path_="";var query_="";var qparms_=null;var fragment_="";var fparms_=null;var unesc=window.decodeURIComponent?decodeURIComponent:unescape;var esc=window.encodeURIComponent?encodeURIComponent:escape;var bundle=null;function parseFrom(url){if(url.match(PARSE_REGEX)===null){throw"Malformed URL: "+url;}schema_=RegExp.$1;authority_=RegExp.$2;path_=RegExp.$3;query_=RegExp.$4;fragment_=RegExp.$5;}function serializeParams(params){var str=[];for(var i=0,j=params.length;i<j;++i){var key=params[i][0];var val=params[i][1];if(typeof val=="undefined"){continue;}str.push(esc(key)+(val!==null?"="+esc(val):""));}return str.join("&");}function getQuery(){if(qparms_){query_=serializeParams(qparms_);qparms_=null;}return query_;}function getFragment(){if(fparms_){fragment_=serializeParams(fparms_);fparms_=null;}return fragment_;}function getQP(key){qparms_=qparms_||parseParams(query_);return getParam(qparms_,key);}function getFP(key){fparms_=fparms_||parseParams(fragment_);return getParam(fparms_,key);}function setQP(argOne,argTwo){qparms_=setParams(qparms_||parseParams(query_),argOne,argTwo);return bundle;}function setFP(argOne,argTwo){fparms_=setParams(fparms_||parseParams(fragment_),argOne,argTwo);return bundle;}function getOrigin(){return[schema_,schema_!==""?":":"",authority_!==""?"//":"",authority_].join("");}function toString(){var query=getQuery();var fragment=getFragment();return[getOrigin(),path_,query!==""?"?":"",query,fragment!==""?"#":"",fragment].join("");}function parseParams(str){var params=[];if(str===""){return params;}var pairs=str.split("&");for(var i=0,j=pairs.length;i<j;++i){var kv=pairs[i].split("=");var key=kv.shift();var value=null;if(kv.length>0){value=kv.join("").replace(/\+/g," ");}params.push([key,value!=null?unesc(value):null]);}return params;}function getParam(pmap,key){for(var i=0,j=pmap.length;i<j;++i){if(pmap[i][0]==key){return pmap[i][1];}}return undefined;}function setParams(pset,argOne,argTwo){var newParams=argOne;if(typeof argOne==="string"){newParams={};newParams[argOne]=argTwo;}for(var key in newParams){var found=false;for(var i=0,j=pset.length;!found&&i<j;++i){if(pset[i][0]==key){pset[i][1]=newParams[key];found=true;}}if(!found){pset.push([key,newParams[key]]);}}return pset;}function stripPrefix(str,pfx){str=str||"";if(str[0]===pfx){str=str.substr(pfx.length);}return str;}if(typeof opt_in==="object"&&typeof opt_in.toString==="function"){parseFrom(opt_in.toString());}else{if(opt_in){parseFrom(opt_in);}}bundle={getSchema:function(){return schema_;},getAuthority:function(){return authority_;},getOrigin:getOrigin,getPath:function(){return path_;},getQuery:getQuery,getFragment:getFragment,getQP:getQP,getFP:getFP,setSchema:function(schema){schema_=schema;return bundle;},setAuthority:function(authority){authority_=authority;return bundle;},setPath:function(path){if(typeof path!=="undefined"&&path!=null){path_=(path[0]==="/"?"":"/")+path;}return bundle;},setQuery:function(query){qparms_=null;query_=stripPrefix(query,"?");return bundle;},setFragment:function(fragment){fparms_=null;fragment_=stripPrefix(fragment,"#");return bundle;},setQP:setQP,setFP:setFP,setExistingP:function(key,val){if(typeof(getQP(key,val))!="undefined"){setQP(key,val);}if(typeof(getFP(key,val))!="undefined"){setFP(key,val);}return bundle;},toString:toString};return bundle;};})();
shindig._uri=shindig.uri;shindig.uri=(function(){var oldCtor=shindig._uri;shindig._uri=null;function hasSameOrigin(self,other){return self.getOrigin()==other.getOrigin();}function resolve(self,base){if(self.getSchema()==""){self.setSchema(base.getSchema());}if(self.getAuthority()==""){self.setAuthority(base.getAuthority());}var selfPath=self.getPath();if(selfPath==""||selfPath.charAt(0)!="/"){var basePath=base.getPath();var lastSlash=basePath.lastIndexOf("/");if(lastSlash!=-1){basePath=basePath.substring(0,lastSlash+1);}self.setPath(base.getPath()+selfPath);}}return function(opt_in){var self=oldCtor(opt_in);self.hasSameOrigin=function(other){return hasSameOrigin(self,other);};self.resolve=function(other){return resolve(self,other);};return self;};})();
Function.prototype.inherits=function(parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;this.superClass_=parentCtor.prototype;this.prototype=new tempCtor();this.prototype.constructor=this;};
shindig.cookies={};shindig.cookies.JsType_={UNDEFINED:"undefined"};shindig.cookies.isDef=function(val){return typeof val!=shindig.cookies.JsType_.UNDEFINED;};shindig.cookies.set=function(name,value,opt_maxAge,opt_path,opt_domain){if(/;=/g.test(name)){throw new Error('Invalid cookie name "'+name+'"');}if(/;/g.test(value)){throw new Error('Invalid cookie value "'+value+'"');}if(!shindig.cookies.isDef(opt_maxAge)){opt_maxAge=-1;}var domainStr=opt_domain?";domain="+opt_domain:"";var pathStr=opt_path?";path="+opt_path:"";var expiresStr;if(opt_maxAge<0){expiresStr="";}else{if(opt_maxAge===0){var pastDate=new Date(1970,1,1);expiresStr=";expires="+pastDate.toUTCString();}else{var futureDate=new Date((new Date).getTime()+opt_maxAge*1000);expiresStr=";expires="+futureDate.toUTCString();}}document.cookie=name+"="+value+domainStr+pathStr+expiresStr;};shindig.cookies.get=function(name,opt_default){var nameEq=name+"=";var cookie=String(document.cookie);for(var pos=-1;(pos=cookie.indexOf(nameEq,pos+1))>=0;){var i=pos;while(--i>=0){var ch=cookie.charAt(i);if(ch==";"){i=-1;break;}}if(i==-1){var end=cookie.indexOf(";",pos);if(end<0){end=cookie.length;}return cookie.substring(pos+nameEq.length,end);}}return opt_default;};shindig.cookies.remove=function(name,opt_path,opt_domain){var rv=shindig.cookies.containsKey(name);shindig.cookies.set(name,"",0,opt_path,opt_domain);return rv;};shindig.cookies.getKeyValues_=function(){var cookie=String(document.cookie);var parts=cookie.split(/\s*;\s*/);var keys=[],values=[],index,part;for(var i=0;part=parts[i];i++){index=part.indexOf("=");if(index==-1){keys.push("");values.push(part);}else{keys.push(part.substring(0,index));values.push(part.substring(index+1));}}return{keys:keys,values:values};};shindig.cookies.getKeys=function(){return shindig.cookies.getKeyValues_().keys;};shindig.cookies.getValues=function(){return shindig.cookies.getKeyValues_().values;};shindig.cookies.isEmpty=function(){return document.cookie==="";};shindig.cookies.getCount=function(){var cookie=String(document.cookie);if(cookie===""){return 0;}var parts=cookie.split(/\s*;\s*/);return parts.length;};shindig.cookies.containsKey=function(key){var sentinel={};return shindig.cookies.get(key,sentinel)!==sentinel;};shindig.cookies.containsValue=function(value){var values=shindig.cookies.getKeyValues_().values;for(var i=0;i<values.length;i++){if(values[i]==value){return true;}}return false;};shindig.cookies.clear=function(){var keys=shindig.cookies.getKeyValues_().keys;for(var i=keys.length-1;i>=0;i--){shindig.cookies.remove(keys[i]);}};shindig.cookies.MAX_COOKIE_LENGTH=3950;
shindig.errors={};shindig.errors.SUBCLASS_RESPONSIBILITY="subclass responsibility";shindig.errors.TO_BE_DONE="to be done";shindig.callAsyncAndJoin=function(functions,continuation,opt_this){var pending=functions.length;var results=[];for(var i=0;i<functions.length;i++){var wrapper=function(index){var fn=functions[index];if(typeof fn==="string"){fn=opt_this[fn];}fn.call(opt_this,function(result){results[index]=result;if(--pending===0){continuation(results);}});};wrapper(i);}};shindig.Extensible=function(){};shindig.Extensible.prototype.setDependencies=function(dependencies){for(var p in dependencies){this[p]=dependencies[p];}};shindig.Extensible.prototype.getDependencies=function(name){return this[name];};shindig.UserPrefStore=function(){};shindig.UserPrefStore.prototype.getPrefs=function(gadget){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.UserPrefStore.prototype.savePrefs=function(gadget){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.DefaultUserPrefStore=function(){shindig.UserPrefStore.call(this);};shindig.DefaultUserPrefStore.inherits(shindig.UserPrefStore);shindig.DefaultUserPrefStore.prototype.getPrefs=function(gadget){};shindig.DefaultUserPrefStore.prototype.savePrefs=function(gadget){};shindig.GadgetService=function(){};shindig.GadgetService.prototype.setHeight=function(elementId,height){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.GadgetService.prototype.setTitle=function(gadget,title){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.GadgetService.prototype.setUserPref=function(id){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.IfrGadgetService=function(){shindig.GadgetService.call(this);gadgets.rpc.register("resize_iframe",this.setHeight);gadgets.rpc.register("set_pref",this.setUserPref);gadgets.rpc.register("set_title",this.setTitle);gadgets.rpc.register("requestNavigateTo",this.requestNavigateTo);gadgets.rpc.register("requestSendMessage",this.requestSendMessage);};shindig.IfrGadgetService.inherits(shindig.GadgetService);shindig.IfrGadgetService.prototype.setHeight=function(height){if(height>shindig.container.maxheight_){height=shindig.container.maxheight_;}var element=document.getElementById(this.f);if(element){element.style.height=height+"px";}};shindig.IfrGadgetService.prototype.setTitle=function(title){var element=document.getElementById(this.f+"_title");if(element){element.innerHTML=title.replace(/&/g,"&amp;").replace(/</g,"&lt;");}};shindig.IfrGadgetService.prototype.setUserPref=function(editToken,name,value){var id=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);var gadget=shindig.container.getGadget(id);for(var i=1,j=arguments.length;i<j;i+=2){this.userPrefs[arguments[i]].value=arguments[i+1];}gadget.saveUserPrefs();};shindig.IfrGadgetService.prototype.requestSendMessage=function(recipients,message,opt_callback,opt_params){if(opt_callback){window.setTimeout(function(){opt_callback(new opensocial.ResponseItem(null,null,opensocial.ResponseItem.Error.NOT_IMPLEMENTED,null));},0);}};shindig.IfrGadgetService.prototype.requestNavigateTo=function(view,opt_params){var id=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);var url=shindig.container.gadgetService.getUrlForView(view);if(opt_params){var paramStr=gadgets.json.stringify(opt_params);if(paramStr.length>0){url+="&appParams="+encodeURIComponent(paramStr);}}if(url&&document.location.href.indexOf(url)==-1){document.location.href=url;}};shindig.IfrGadgetService.prototype.getUrlForView=function(view){if(view==="canvas"){return"/canvas";}else{if(view==="profile"){return"/profile";}else{return null;}}};shindig.IfrGadgetService.prototype.getGadgetIdFromModuleId=function(moduleId){return parseInt(moduleId.match(/_([0-9]+)$/)[1],10);};shindig.LayoutManager=function(){};shindig.LayoutManager.prototype.getGadgetChrome=function(gadget){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.StaticLayoutManager=function(){shindig.LayoutManager.call(this);};shindig.StaticLayoutManager.inherits(shindig.LayoutManager);shindig.StaticLayoutManager.prototype.setGadgetChromeIds=function(gadgetChromeIds){this.gadgetChromeIds_=gadgetChromeIds;};shindig.StaticLayoutManager.prototype.getGadgetChrome=function(gadget){var chromeId=this.gadgetChromeIds_[gadget.id];return chromeId?document.getElementById(chromeId):null;};shindig.FloatLeftLayoutManager=function(layoutRootId){shindig.LayoutManager.call(this);this.layoutRootId_=layoutRootId;};shindig.FloatLeftLayoutManager.inherits(shindig.LayoutManager);shindig.FloatLeftLayoutManager.prototype.getGadgetChrome=function(gadget){var layoutRoot=document.getElementById(this.layoutRootId_);if(layoutRoot){var chrome=document.createElement("div");chrome.className="gadgets-gadget-chrome";chrome.style.cssFloat="left";layoutRoot.appendChild(chrome);return chrome;}else{return null;}};shindig.Gadget=function(params){this.userPrefs={};if(params){for(var name in params){if(params.hasOwnProperty(name)){this[name]=params[name];}}}if(!this.secureToken){this.secureToken="john.doe:john.doe:appid:cont:url:0:default";}};shindig.Gadget.prototype.setServerBase=function(url){this.serverBase_=url;};shindig.Gadget.prototype.getServerBase=function(){return this.serverBase_;};shindig.Gadget.prototype.getUserPrefs=function(){return this.userPrefs;};shindig.Gadget.prototype.saveUserPrefs=function(){shindig.container.userPrefStore.savePrefs(this);};shindig.Gadget.prototype.getUserPrefValue=function(name){var pref=this.userPrefs[name];return typeof(pref.value)!="undefined"&&pref.value!=null?pref.value:pref["default"];};shindig.Gadget.prototype.render=function(chrome){if(chrome){var gadget=this;this.getContent(function(content){chrome.innerHTML=content;gadget.finishRender(chrome);});}};shindig.Gadget.prototype.getContent=function(continuation){shindig.callAsyncAndJoin(["getTitleBarContent","getUserPrefsDialogContent","getMainContent"],function(results){continuation(results.join(""));},this);};shindig.Gadget.prototype.getTitleBarContent=function(continuation){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.getUserPrefsDialogContent=function(continuation){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.getMainContent=function(continuation){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.finishRender=function(chrome){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.getAdditionalParams=function(){return"";};shindig.BaseIfrGadget=function(opt_params){shindig.Gadget.call(this,opt_params);if(!this.serverBase_){this.serverBase_="/gadgets/";}else{if(this.serverBase_.indexOf("/gadgets")<0){this.serverBase_+="/gadgets/";}}this.queryIfrGadgetType_();};shindig.BaseIfrGadget.inherits(shindig.Gadget);shindig.BaseIfrGadget.prototype.GADGET_IFRAME_PREFIX_="remote_iframe_";shindig.BaseIfrGadget.prototype.CONTAINER="default";shindig.BaseIfrGadget.prototype.cssClassGadget="gadgets-gadget";shindig.BaseIfrGadget.prototype.cssClassTitleBar="gadgets-gadget-title-bar";shindig.BaseIfrGadget.prototype.cssClassTitle="gadgets-gadget-title";shindig.BaseIfrGadget.prototype.cssClassTitleButtonBar="gadgets-gadget-title-button-bar";shindig.BaseIfrGadget.prototype.cssClassGadgetUserPrefsDialog="gadgets-gadget-user-prefs-dialog";shindig.BaseIfrGadget.prototype.cssClassGadgetUserPrefsDialogActionBar="gadgets-gadget-user-prefs-dialog-action-bar";shindig.BaseIfrGadget.prototype.cssClassTitleButton="gadgets-gadget-title-button";shindig.BaseIfrGadget.prototype.cssClassGadgetContent="gadgets-gadget-content";shindig.BaseIfrGadget.prototype.rpcToken=(2147483647*Math.random())|0;shindig.BaseIfrGadget.prototype.rpcRelay="../container/rpc_relay.html";shindig.BaseIfrGadget.prototype.getTitleBarContent=function(continuation){var settingsButton=this.hasViewablePrefs_()?'<a href="#" onclick="shindig.container.getGadget('+this.id+').handleOpenUserPrefsDialog();return false;" class="'+this.cssClassTitleButton+'">settings</a> ':"";continuation('<div id="'+this.cssClassTitleBar+"-"+this.id+'" class="'+this.cssClassTitleBar+'"><span id="'+this.getIframeId()+'_title" class="'+this.cssClassTitle+'">'+(this.title?this.title:"Title")+'</span> | <span class="'+this.cssClassTitleButtonBar+'">'+settingsButton+'<a href="#" onclick="shindig.container.getGadget('+this.id+').handleToggle();return false;" class="'+this.cssClassTitleButton+'">toggle</a></span></div>');};shindig.BaseIfrGadget.prototype.getUserPrefsDialogContent=function(continuation){continuation('<div id="'+this.getUserPrefsDialogId()+'" class="'+this.cssClassGadgetUserPrefsDialog+'"></div>');};shindig.BaseIfrGadget.prototype.getMainContent=function(continuation){var gadget=this;window.setTimeout(function(){gadget.getMainContent(continuation);},0);};shindig.BaseIfrGadget.prototype.getIframeId=function(){return this.GADGET_IFRAME_PREFIX_+this.id;};shindig.BaseIfrGadget.prototype.getUserPrefsDialogId=function(){return this.getIframeId()+"_userPrefsDialog";};shindig.BaseIfrGadget.prototype.getUserPrefsParams=function(){var params="";for(var name in this.getUserPrefs()){params+="&up_"+encodeURIComponent(name)+"="+encodeURIComponent(this.getUserPrefValue(name));}return params;};shindig.BaseIfrGadget.prototype.handleToggle=function(){var gadgetIframe=document.getElementById(this.getIframeId());if(gadgetIframe){var gadgetContent=gadgetIframe.parentNode;var display=gadgetContent.style.display;gadgetContent.style.display=display?"":"none";}};shindig.BaseIfrGadget.prototype.hasViewablePrefs_=function(){for(var name in this.getUserPrefs()){var pref=this.userPrefs[name];if(pref.type!="hidden"){return true;}}return false;};shindig.BaseIfrGadget.prototype.handleOpenUserPrefsDialog=function(){if(this.userPrefsDialogContentLoaded){this.showUserPrefsDialog();}else{var gadget=this;var igCallbackName="ig_callback_"+this.id;window[igCallbackName]=function(userPrefsDialogContent){gadget.userPrefsDialogContentLoaded=true;gadget.buildUserPrefsDialog(userPrefsDialogContent);gadget.showUserPrefsDialog();};var script=document.createElement("script");script.src="http://www.gmodules.com/ig/gadgetsettings?mid="+this.id+"&output=js"+this.getUserPrefsParams()+"&url="+this.specUrl;document.body.appendChild(script);}};shindig.BaseIfrGadget.prototype.buildUserPrefsDialog=function(content){var userPrefsDialog=document.getElementById(this.getUserPrefsDialogId());userPrefsDialog.innerHTML=content+'<div class="'+this.cssClassGadgetUserPrefsDialogActionBar+'"><input type="button" value="Save" onclick="shindig.container.getGadget('+this.id+').handleSaveUserPrefs()"> <input type="button" value="Cancel" onclick="shindig.container.getGadget('+this.id+').handleCancelUserPrefs()"></div>';userPrefsDialog.childNodes[0].style.display="";};shindig.BaseIfrGadget.prototype.showUserPrefsDialog=function(opt_show){var userPrefsDialog=document.getElementById(this.getUserPrefsDialogId());userPrefsDialog.style.display=(opt_show||typeof opt_show=="undefined")?"":"none";};shindig.BaseIfrGadget.prototype.hideUserPrefsDialog=function(){this.showUserPrefsDialog(false);};shindig.BaseIfrGadget.prototype.handleSaveUserPrefs=function(){this.hideUserPrefsDialog();var numFields=document.getElementById("m_"+this.id+"_numfields").value;for(var i=0;i<numFields;i++){var input=document.getElementById("m_"+this.id+"_"+i);var userPrefNamePrefix="m_"+this.id+"_up_";var userPrefName=input.name.substring(userPrefNamePrefix.length);var userPrefValue=input.value;this.userPrefs[userPrefName].value=userPrefValue;}this.saveUserPrefs();this.refresh();};shindig.BaseIfrGadget.prototype.handleCancelUserPrefs=function(){this.hideUserPrefsDialog();};shindig.BaseIfrGadget.prototype.refresh=function(){var iframeId=this.getIframeId();document.getElementById(iframeId).src=this.getIframeUrl(Math.random());};shindig.BaseIfrGadget.prototype.queryIfrGadgetType_=function(){var request={context:{country:"default",language:"default",view:"default",container:"default"},gadgets:[{url:this.specUrl,moduleId:1}]};var makeRequestParams={"CONTENT_TYPE":"JSON","METHOD":"POST","POST_DATA":gadgets.json.stringify(request)};var url=this.serverBase_+"metadata?st="+this.secureToken;gadgets.io.makeNonProxiedRequest(url,handleJSONResponse,makeRequestParams,{"Content-Type":"application/javascript"});var gadget=this;function handleJSONResponse(obj){var requiresPubSub2=false;var arr=obj.data.gadgets[0].features;for(var i=0;i<arr.length;i++){if(arr[i]==="pubsub-2"){requiresPubSub2=true;break;}}var subClass=requiresPubSub2?shindig.OAAIfrGadget:shindig.IfrGadget;for(var name in subClass){if(subClass.hasOwnProperty(name)){gadget[name]=subClass[name];}}}};shindig.IfrGadget={getMainContent:function(continuation){var iframeId=this.getIframeId();gadgets.rpc.setRelayUrl(iframeId,this.serverBase_+this.rpcRelay);gadgets.rpc.setAuthToken(iframeId,this.rpcToken);continuation('<div class="'+this.cssClassGadgetContent+'"><iframe id="'+iframeId+'" name="'+iframeId+'" class="'+this.cssClassGadget+'" src="about:blank'+'" frameborder="no" scrolling="no"'+(this.height?' height="'+this.height+'"':"")+(this.width?' width="'+this.width+'"':"")+"></iframe></div>");},finishRender:function(chrome){window.frames[this.getIframeId()].location=this.getIframeUrl();},getIframeUrl:function(random){return this.serverBase_+"ifr?"+"container="+this.CONTAINER+"&mid="+this.id+"&nocache="+shindig.container.nocache_+"&country="+shindig.container.country_+"&lang="+shindig.container.language_+"&view="+shindig.container.view_+(this.specVersion?"&v="+this.specVersion:"")+(shindig.container.parentUrl_?"&parent="+encodeURIComponent(shindig.container.parentUrl_):"")+(this.debug?"&debug=1":"")+this.getAdditionalParams()+this.getUserPrefsParams()+(this.secureToken?"&st="+this.secureToken:"")+"&url="+encodeURIComponent(this.specUrl)+(this.viewParams?"&view-params="+encodeURIComponent(gadgets.json.stringify(this.viewParams)):"")+(random?"&r="+random:"")+"#rpctoken="+this.rpcToken+(this.hashData?"&"+this.hashData:"");}};shindig.OAAIfrGadget={getMainContent:function(continuation){continuation('<div id="'+this.cssClassGadgetContent+"-"+this.id+'" class="'+this.cssClassGadgetContent+'"></div>');},finishRender:function(chrome){var iframeAttrs={className:this.cssClassGadget,frameborder:"no",scrolling:"no"};if(this.height){iframeAttrs.height=this.height;}if(this.width){iframeAttrs.width=this.width;}new OpenAjax.hub.IframeContainer(gadgets.pubsub2router.hub,this.getIframeId(),{Container:{onSecurityAlert:function(source,alertType){gadgets.error("Security error for container "+source.getClientID()+" : "+alertType);source.getIframe().src="about:blank";}},IframeContainer:{parent:document.getElementById(this.cssClassGadgetContent+"-"+this.id),uri:this.getIframeUrl(),tunnelURI:shindig.uri(this.serverBase_+this.rpcRelay).resolve(shindig.uri(window.location.href)),iframeAttrs:iframeAttrs}});},getIframeUrl:function(random){return this.serverBase_+"ifr?"+"container="+this.CONTAINER+"&mid="+this.id+"&nocache="+shindig.container.nocache_+"&country="+shindig.container.country_+"&lang="+shindig.container.language_+"&view="+shindig.container.view_+(this.specVersion?"&v="+this.specVersion:"")+(this.debug?"&debug=1":"")+this.getAdditionalParams()+this.getUserPrefsParams()+(this.secureToken?"&st="+this.secureToken:"")+"&url="+encodeURIComponent(this.specUrl)+(this.viewParams?"&view-params="+encodeURIComponent(gadgets.json.stringify(this.viewParams)):"")+(random?"&r="+random:"")+(this.hashData?"#"+this.hashData:"");}};shindig.Container=function(){this.gadgets_={};this.parentUrl_=document.location.href+"://"+document.location.host;this.country_="ALL";this.language_="ALL";this.view_="default";this.nocache_=1;this.maxheight_=2147483647;};shindig.Container.inherits(shindig.Extensible);shindig.Container.prototype.gadgetClass=shindig.Gadget;shindig.Container.prototype.userPrefStore=new shindig.DefaultUserPrefStore();shindig.Container.prototype.gadgetService=new shindig.GadgetService();shindig.Container.prototype.layoutManager=new shindig.StaticLayoutManager();shindig.Container.prototype.setParentUrl=function(url){this.parentUrl_=url;};shindig.Container.prototype.setCountry=function(country){this.country_=country;};shindig.Container.prototype.setNoCache=function(nocache){this.nocache_=nocache;};shindig.Container.prototype.setLanguage=function(language){this.language_=language;};shindig.Container.prototype.setView=function(view){this.view_=view;};shindig.Container.prototype.setMaxHeight=function(maxheight){this.maxheight_=maxheight;};shindig.Container.prototype.getGadgetKey_=function(instanceId){return"gadget_"+instanceId;};shindig.Container.prototype.getGadget=function(instanceId){return this.gadgets_[this.getGadgetKey_(instanceId)];};shindig.Container.prototype.createGadget=function(opt_params){return new this.gadgetClass(opt_params);};shindig.Container.prototype.addGadget=function(gadget){gadget.id=this.getNextGadgetInstanceId();this.gadgets_[this.getGadgetKey_(gadget.id)]=gadget;};shindig.Container.prototype.addGadgets=function(gadgets){for(var i=0;i<gadgets.length;i++){this.addGadget(gadgets[i]);}};shindig.Container.prototype.renderGadgets=function(){for(var key in this.gadgets_){this.renderGadget(this.gadgets_[key]);}};shindig.Container.prototype.renderGadget=function(gadget){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Container.prototype.nextGadgetInstanceId_=0;shindig.Container.prototype.getNextGadgetInstanceId=function(){return this.nextGadgetInstanceId_++;};shindig.Container.prototype.refreshGadgets=function(){for(var key in this.gadgets_){this.gadgets_[key].refresh();}};shindig.IfrContainer=function(){shindig.Container.call(this);};shindig.IfrContainer.inherits(shindig.Container);shindig.IfrContainer.prototype.gadgetClass=shindig.BaseIfrGadget;shindig.IfrContainer.prototype.gadgetService=new shindig.IfrGadgetService();shindig.IfrContainer.prototype.setParentUrl=function(url){if(!url.match(/^http[s]?:\/\//)){url=document.location.href.match(/^[^?#]+\//)[0]+url;}this.parentUrl_=url;};shindig.IfrContainer.prototype.renderGadget=function(gadget){var chrome=this.layoutManager.getGadgetChrome(gadget);gadget.render(chrome);};function init(config){var sbase=config["shindig-container"];shindig.Gadget.prototype.setServerBase(sbase.serverBase);}if(gadgets.config){gadgets.config.register("shindig-container",null,init);}shindig.container=new shindig.IfrContainer();
if(gadgets&&gadgets.rpc){osapi._handleGadgetRpcMethod=function(requests){var responses=new Array(requests.length);var callCount=0;var callback=this.callback;var dummy=function(params,apiCallback){apiCallback({});};for(var i=0;i<requests.length;i++){var current=osapi;if(requests[i].method.indexOf("_")==-1){var path=requests[i].method.split(".");for(var j=0;j<path.length;j++){if(current.hasOwnProperty(path[j])){current=current[path[j]];}else{current=dummy;break;}}}else{current=dummy;}current(requests[i].params,function(i){return function(response){responses[i]={id:requests[i].id,data:response};callCount++;if(callCount==requests.length){callback(responses);}};}(i));}};osapi.container={};osapi.container["listMethods"]=function(request,callback){var names=[];recurseNames(osapi,"",5,names);callback(names);};function recurseNames(base,path,depth,accumulated){if(depth==0){return;}for(var prop in base){if(base.hasOwnProperty(prop)){if(prop.indexOf("_")==-1){var type=typeof(base[prop]);if(type=="function"){accumulated.push(path+prop);}else{if(type=="object"){recurseNames(base[prop],path+prop+".",depth-1,accumulated);}}}}}}gadgets.rpc.register("osapi._handleGadgetRpcMethod",osapi._handleGadgetRpcMethod);}
