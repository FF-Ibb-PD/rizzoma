backends = require('./backends')
frontends = require('./frontends')

class CacheFactory
    constructor: () ->
        @_defaultFrontend = 'BaseFrontend'

    getCache: (settings) ->
        backend = @_getBackend(settings)
        frontend = @_getFrontend(backend, settings)
        return frontend

    _getBackend: (settings) ->
        backend = settings.backend
        throw new Error("Backend Name not specified") if not backend
        if typeof backend == "string"
            BackendClass = backends[backend]
            throw new Error("Invalid backend name '#{backend}'") if not BackendClass
            backend = new BackendClass(settings.backendOptions or {})
        return backend

    _getFrontend: (backend, settings) ->
        frontend = settings.frontend or @_defaultFrontend
        if typeof frontend == "string"
            FrontendClass = frontends[frontend]
            throw new Error("Invalid frontend name '#{frontend}'") if not FrontendClass
            frontendOptions = settings.frontendOptions or {}
            frontendOptions.backend = backend
            frontend = new FrontendClass(frontendOptions)
        return frontend

module.exports = new CacheFactory()
